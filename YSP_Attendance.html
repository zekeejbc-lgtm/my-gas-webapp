<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  var doc = root.document || null;
  var globalYsp = (root.YSP = root.YSP || {});
  var utils = (globalYsp.utils = globalYsp.utils || {});
  var callServer = typeof utils.callServer === 'function' ? utils.callServer : function () {};
  var selectOne = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var escapeHtml = typeof root.esc === 'function'
    ? root.esc
    : function (value) {
        return String(value == null ? '' : value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      };
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};

  function loadMyAttendance() {
    callServer(
      'getMyAttendance',
      [],
      function (res) {
        var rows = (res && res.data) || res || [];
        renderAttendanceTable(rows);
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load attendance records.');
      },
      [
        { date: '2024-01-12', event: 'Leadership Summit', timeIn: '08:00', timeOut: '17:00' },
        { date: '2024-02-05', event: 'Community Outreach', timeIn: '09:00', timeOut: '15:00' },
      ]
    );
  }

  function renderAttendanceTable(rows) {
    var tbody = selectOne('#attendance-rows');
    if (!tbody) {
      return;
    }
    tbody.innerHTML = '';
    if (!rows || !rows.length) {
      if (doc && typeof doc.createElement === 'function') {
        var empty = doc.createElement('tr');
        empty.innerHTML = '<td colspan="4" class="muted">No attendance records yet.</td>';
        tbody.appendChild(empty);
      }
      return;
    }
    rows.forEach(function (row) {
      if (!doc || typeof doc.createElement !== 'function') {
        return;
      }
      var tr = doc.createElement('tr');
      tr.innerHTML =
        '<td>' +
        escapeHtml(row.date || row[0] || '') +
        '</td><td>' +
        escapeHtml(row.event || row[1] || '') +
        '</td><td>' +
        escapeHtml(row.timeIn || row[2] || '') +
        '</td><td>' +
        escapeHtml(row.timeOut || row[3] || '') +
        '</td>';
      tbody.appendChild(tr);
    });
  }

  globalYsp.attendance = globalYsp.attendance || {};
  globalYsp.attendance.loadMyAttendance = loadMyAttendance;
  globalYsp.attendance.renderAttendanceTable = renderAttendanceTable;

  root.loadMyAttendance = loadMyAttendance;
  root.renderAttendanceTable = renderAttendanceTable;
});
</script>
