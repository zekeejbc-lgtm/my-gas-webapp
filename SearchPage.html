<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YSP Tagum — Member App</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Lexend:wght@500;600;700&family=Roboto:wght@400;500;700&display=swap"
    rel="stylesheet"
  />
  <link rel="icon" href="https://i.imgur.com/J4wddTW.png" />
  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root {
  --font-display: 'Lexend', sans-serif;
  --font-body: 'Roboto', sans-serif;
  --primary: #f6421f;
  --primary-strong: #d83819;
  --secondary: #ee8724;
  --accent: #fbcb29;
  --surface: rgba(255, 255, 255, 0.96);
  --surface-muted: rgba(255, 255, 255, 0.72);
  --text-dark: #1d1d1f;
  --text-muted: rgba(0, 0, 0, 0.62);
  --shadow-lg: 0 20px 45px rgba(0, 0, 0, 0.18);
  --shadow-md: 0 12px 28px rgba(0, 0, 0, 0.14);
  --shadow-sm: 0 6px 18px rgba(0, 0, 0, 0.1);
  --radius-xl: 28px;
  --radius-lg: 20px;
  --radius-md: 14px;
  --radius-sm: 10px;
  --space-xs: clamp(6px, 0.75vw, 12px);
  --space-sm: clamp(10px, 1vw, 16px);
  --space-md: clamp(16px, 1.8vw, 24px);
  --space-lg: clamp(24px, 2.6vw, 36px);
  --space-xl: clamp(32px, 3.5vw, 48px);
  --gradient-bg: linear-gradient(135deg, rgba(246, 66, 31, 0.95), rgba(238, 135, 36, 0.92), rgba(251, 203, 41, 0.9));
  color-scheme: light;
  font-size: 16px;
}

*, *::before, *::after {
  box-sizing: border-box;
}

html,
body {
  margin: 0;
  padding: 0;
  min-height: 100%;
  width: 100%;
}

body {
  font-family: var(--font-body);
  color: var(--text-dark);
  background: var(--gradient-bg);
  background-size: 200% 200%;
  animation: gradient-shift 24s ease infinite;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: clamp(24px, 6vw, 64px) clamp(12px, 4vw, 48px);
  -webkit-font-smoothing: antialiased;
}

@media (max-width: 480px) {
  body {
    padding: 20px 10px;
  }
}

@media (prefers-reduced-motion: reduce) {
  body {
    animation: none;
  }
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: linear-gradient(160deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.05));
  pointer-events: none;
  z-index: 0;
}

.app-shell {
  position: relative;
  z-index: 1;
  width: min(100%, 1180px);
  display: grid;
  gap: var(--space-lg);
}

@media (min-width: 1440px) {
  .app-shell {
    width: min(100%, 1320px);
    gap: clamp(28px, 3vw, 48px);
  }
}

h1,
h2,
h3,
h4 {
  font-family: var(--font-display);
  margin: 0 0 var(--space-sm);
  line-height: 1.2;
}

p {
  margin: 0 0 var(--space-sm);
  line-height: 1.6;
}

a {
  color: inherit;
}

ul {
  margin: 0;
  padding-left: 1.2rem;
}

button,
input,
select,
textarea {
  font-family: inherit;
  font-size: 1rem;
}

:focus-visible {
  outline: 3px solid rgba(246, 66, 31, 0.35);
  outline-offset: 3px;
}

@keyframes gradient-shift {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}
</style>
<style>
.panel {
  background: var(--surface);
  border-radius: var(--radius-xl);
  padding: clamp(24px, 4vw, 42px);
  box-shadow: var(--shadow-lg);
  display: none;
  flex-direction: column;
  gap: var(--space-md);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.45);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.panel.active {
  display: flex !important;
  opacity: 1;
  transform: translateY(0);
}

.panel.hidden {
  display: none !important;
  opacity: 0;
  transform: translateY(12px) scale(0.99);
  pointer-events: none;
}

.panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-md);
}

.panel-title {
  font-size: clamp(1.35rem, 2vw, 1.8rem);
}

.panel-subtitle {
  color: var(--text-muted);
  margin: 0;
}

.card {
  background: rgba(255, 255, 255, 0.9);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  box-shadow: var(--shadow-sm);
  border: 1px solid rgba(0, 0, 0, 0.04);
}

.card h3 {
  margin-bottom: var(--space-sm);
}

.profile-card {
  display: grid;
  gap: var(--space-md);
}

.profile-info {
  display: flex;
  gap: var(--space-md);
  align-items: center;
}

.profile-info img {
  width: 96px;
  height: 96px;
  border-radius: 18px;
  object-fit: cover;
  box-shadow: var(--shadow-sm);
}

.profile-qr {
  display: grid;
  justify-items: start;
  gap: var(--space-sm);
}

.qr-box {
  width: 180px;
  height: 180px;
  background: rgba(0, 0, 0, 0.04);
  border-radius: var(--radius-md);
  display: grid;
  place-items: center;
  padding: var(--space-sm);
}

.btn {
  --btn-bg: rgba(255, 255, 255, 0.9);
  --btn-color: var(--text-dark);
  --btn-border: transparent;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  min-height: 44px;
  padding: 0 1.25rem;
  border-radius: 999px;
  border: 1px solid var(--btn-border);
  background: var(--btn-bg);
  color: var(--btn-color);
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
}

.btn:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-sm);
}

.btn:active {
  transform: translateY(1px);
}

.btn-primary {
  --btn-bg: linear-gradient(135deg, var(--primary), var(--secondary));
  --btn-color: #fff;
}

.btn-outline {
  --btn-bg: transparent;
  --btn-border: rgba(246, 66, 31, 0.45);
  color: var(--primary);
  background: rgba(246, 66, 31, 0.06);
}

.btn-text {
  background: none;
  border: none;
  padding: 0;
  min-height: auto;
  color: var(--primary);
}

.btn-block {
  width: 100%;
}

.button-row {
  display: flex;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

.button-stack {
  display: grid;
  gap: var(--space-sm);
}

.tile-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: var(--space-md);
}

.tile {
  position: relative;
  padding: var(--space-md);
  border-radius: var(--radius-lg);
  background: rgba(255, 255, 255, 0.88);
  border: 1px solid rgba(0, 0, 0, 0.05);
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  display: grid;
  gap: var(--space-sm);
}

.tile:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-md);
}

.tile-icon {
  font-size: 1.6rem;
}

.grid.two {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: var(--space-md);
}

.grid.three {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-md);
}

.ratio {
  position: relative;
  width: 100%;
  overflow: hidden;
  border-radius: var(--radius-lg);
  background: rgba(0, 0, 0, 0.05);
}

.ratio-16x9::before {
  content: '';
  display: block;
  padding-bottom: 56.25%;
}

.ratio img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.bullet-list {
  display: grid;
  gap: 0.35rem;
  padding-left: 1.1rem;
}

.suggestions {
  list-style: none;
  padding: 0;
  margin: var(--space-sm) 0 0;
  border-radius: var(--radius-md);
  background: rgba(255, 255, 255, 0.86);
  box-shadow: var(--shadow-sm);
  border: 1px solid rgba(0, 0, 0, 0.04);
  max-height: 220px;
  overflow: auto;
}

.suggestions li {
  padding: 0.75rem 1rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.suggestions li:hover,
.suggestions li.active {
  background: rgba(246, 66, 31, 0.08);
}

.table-card {
  padding: 0;
}

.table-wrapper {
  overflow: auto;
  border-radius: inherit;
}

table {
  width: 100%;
  border-collapse: collapse;
  min-width: 480px;
}

thead th {
  position: sticky;
  top: 0;
  background: rgba(246, 66, 31, 0.12);
  padding: 0.85rem 1rem;
  text-align: left;
  font-weight: 600;
}

tbody td {
  padding: 0.75rem 1rem;
  border-top: 1px solid rgba(0, 0, 0, 0.06);
}

.stack {
  display: grid;
  gap: var(--space-sm);
}

.scan-log {
  display: grid;
  gap: 0.75rem;
}

.scan-entry {
  padding: 0.75rem 1rem;
  border-radius: var(--radius-md);
  background: rgba(246, 66, 31, 0.08);
  border: 1px solid rgba(246, 66, 31, 0.18);
}

.scanner-box {
  margin-top: var(--space-md);
  border-radius: var(--radius-lg);
  background: rgba(0, 0, 0, 0.05);
  min-height: 240px;
  display: grid;
  place-items: center;
}

.toast-container {
  position: fixed;
  inset: auto 50px 32px 50px;
  display: grid;
  justify-items: center;
  gap: 12px;
  pointer-events: none;
  z-index: 9999;
}

.toast {
  background: rgba(29, 29, 31, 0.92);
  color: #fff;
  padding: 0.75rem 1.25rem;
  border-radius: 999px;
  box-shadow: var(--shadow-md);
  pointer-events: auto;
  animation: toast-in 0.25s ease;
}

@keyframes toast-in {
  from {
    opacity: 0;
    transform: translateY(12px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-root {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  z-index: 1000;
}

.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  backdrop-filter: blur(4px);
}

.modal {
  position: relative;
  width: min(96vw, 480px);
  transform: translateY(12px);
  opacity: 0;
  transition: opacity 0.25s ease, transform 0.25s ease;
}

.modal.is-open {
  transform: translateY(0);
  opacity: 1;
}

.modal__panel {
  background: var(--surface);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  box-shadow: var(--shadow-lg);
  display: grid;
  gap: var(--space-md);
}

.modal__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-sm);
}

.modal__close {
  background: none;
  border: none;
  font-size: 1.6rem;
  line-height: 1;
  cursor: pointer;
  color: var(--text-muted);
}

.modal__body {
  display: grid;
  gap: var(--space-sm);
}

.modal__footer {
  display: flex;
  gap: var(--space-sm);
  justify-content: flex-end;
}

.eye-toggle {
  position: relative;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: rgba(246, 66, 31, 0.12);
  cursor: pointer;
  display: grid;
  place-items: center;
  overflow: hidden;
}

.eye-toggle .eye {
  position: relative;
  width: 22px;
  height: 12px;
  border-radius: 12px / 6px;
  background: rgba(246, 66, 31, 0.35);
  transition: transform 0.3s ease;
}

.eye-toggle .eye-ball {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--primary);
  transform: translate(-50%, -50%);
  transition: transform 0.3s ease;
}

.eye-toggle .eye-lid {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  border-top: 2px solid rgba(246, 66, 31, 0.6);
  transform: rotate(0deg);
  transform-origin: center;
  transition: transform 0.3s ease;
}

.eye-toggle.is-visible .eye {
  transform: scaleX(1.1);
}

.eye-toggle.is-visible .eye-ball {
  transform: translate(-50%, -50%) scale(0.75);
}

.eye-toggle.is-visible .eye-lid {
  transform: rotate(45deg);
}

.eye-toggle.is-animating::after {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(246, 66, 31, 0.18);
  animation: pulse 0.4s ease;
}

@keyframes pulse {
  from {
    opacity: 0.8;
    transform: scale(0.92);
  }
  to {
    opacity: 0;
    transform: scale(1.2);
  }
}

.muted {
  color: var(--text-muted);
}

.form-group {
  display: grid;
  gap: 0.35rem;
}

.password-input {
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: 0.5rem;
}

input,
select,
textarea {
  border-radius: var(--radius-md);
  border: 1px solid rgba(0, 0, 0, 0.12);
  padding: 0.75rem 1rem;
  background: rgba(255, 255, 255, 0.92);
  transition: border 0.2s ease, box-shadow 0.2s ease;
}

input:focus,
select:focus,
textarea:focus {
  border-color: rgba(246, 66, 31, 0.45);
  box-shadow: 0 0 0 3px rgba(246, 66, 31, 0.18);
}

textarea {
  resize: vertical;
}

.form-actions {
  display: grid;
  gap: var(--space-sm);
}

.login-illustration {
  display: grid;
  place-items: center;
  background: linear-gradient(140deg, rgba(246, 66, 31, 0.16), rgba(251, 203, 41, 0.16));
  border-radius: var(--radius-lg);
  padding: clamp(24px, 6vw, 48px);
}

.login-brand {
  text-align: center;
  display: grid;
  gap: var(--space-sm);
}

.login-logo {
  width: 84px;
  height: 84px;
  object-fit: contain;
}

.login-title {
  font-size: clamp(1.5rem, 2.2vw, 2.25rem);
}

.login-subtitle,
.login-footnote {
  color: var(--text-muted);
}

.login-form {
  display: grid;
  gap: var(--space-md);
  background: rgba(255, 255, 255, 0.92);
  padding: clamp(24px, 3vw, 36px);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
}

.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.upload-fallback {
  display: grid;
  gap: 0.35rem;
  margin-top: var(--space-sm);
}

@media (max-width: 960px) {
  .panel-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .profile-info {
    flex-direction: column;
    align-items: flex-start;
  }
}

@media (max-width: 720px) {
  body {
    padding: 20px 12px;
    align-items: flex-start;
  }

  .app-shell {
    width: 100%;
  }

  .panel {
    padding: clamp(20px, 5vw, 28px);
  }

  .login-illustration {
    display: none;
  }

  .login-form {
    box-shadow: var(--shadow-lg);
  }

  #login-panel {
    display: grid;
    gap: var(--space-md);
    grid-template-columns: 1fr;
  }
}

@media (max-width: 420px) {
  .tile-grid {
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  }

  .button-row {
    flex-direction: column;
  }

  table {
    min-width: 420px;
  }
}

.status-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.25rem 0.75rem;
  border-radius: 999px;
  background: rgba(0, 0, 0, 0.08);
  color: var(--text-dark);
  font-size: 0.85rem;
  font-weight: 600;
}

.status-badge.active {
  background: rgba(246, 66, 31, 0.16);
  color: var(--primary-strong);
}
</style>
<style>
#login-panel {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--space-lg);
  align-items: stretch;
  min-height: clamp(520px, 70vh, 760px);
}

#login-panel .login-form {
  width: min(100%, 420px);
  margin: 0 auto;
}

@media (min-width: 960px) {
  #login-panel {
    grid-template-columns: minmax(0, 1fr) minmax(0, 0.9fr);
    align-items: center;
  }

  #login-panel .login-form {
    margin: 0;
  }
}

@media (min-width: 1280px) {
  #login-panel {
    grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
  }
}

#main-menu-panel,
#homepage-panel,
#profile-panel,
#qr-attendance-panel,
#manual-attendance-panel,
#attendance-dashboard-panel,
#attendance-trans-panel,
#manage-events-panel,
#directory-panel,
#announcements-panel,
#submit-feedback-panel,
#view-feedback-panel,
#view-logs-panel {
  max-width: 100%;
}

.panel .panel-body,
.panel .card,
.panel .section { 
  width: 100%;
}

#main-menu-panel .panel-header {
  align-items: flex-start;
}

#projects-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: var(--space-md);
}

.project-card {
  display: grid;
  gap: var(--space-sm);
  border-radius: var(--radius-lg);
  overflow: hidden;
  background: rgba(255, 255, 255, 0.92);
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.project-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-md);
}

.project-card img {
  width: 100%;
  height: 160px;
  object-fit: cover;
}

#projects-grid .project-card .project-body {
  padding: 0 1rem 1rem;
  color: var(--text-muted);
}

#directory-result {
  min-height: 160px;
}

#announcement-list .announcement-card,
#my-feedback-list .feedback-card,
#feedback-admin-list .feedback-card,
#scan-output .scan-entry,
#events-rows tr,
#attendance-rows tr,
#access-log-rows tr {
  transition: background 0.2s ease;
}

#scan-output .scan-entry.success {
  border-color: rgba(46, 204, 113, 0.4);
  background: rgba(46, 204, 113, 0.14);
}

#scan-output .scan-entry.error {
  border-color: rgba(255, 59, 48, 0.4);
  background: rgba(255, 59, 48, 0.14);
}

.table-wrapper table tr:hover {
  background: rgba(0, 0, 0, 0.03);
}

#toast-root {
  position: fixed;
  inset: auto 50% 32px 50%;
  transform: translateX(-50%);
  width: min(100%, 420px);
  pointer-events: none;
  display: grid;
  gap: 12px;
  z-index: 2000;
}

@media (min-width: 1024px) {
  #projects-grid {
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  }

  .tile-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }
}

@media (max-width: 720px) {
  #toast-root {
    inset: auto 16px 16px 16px;
    transform: none;
    width: auto;
  }
}
</style>
</head>
<body>
  <div id="app" class="app-shell">
    <section class="panel" id="login-panel">
      <div class="login-illustration">
        <div class="login-brand">
          <img src="https://i.imgur.com/J4wddTW.png" alt="YSP Tagum" class="login-logo" />
          <h1 class="login-title">YSP Tagum Member Portal</h1>
          <p class="login-subtitle">Empowering young leaders through unified service and collaboration.</p>
        </div>
      </div>
      <div class="login-form" role="form" aria-labelledby="login-heading">
        <h2 id="login-heading">Sign in</h2>
        <div class="form-group">
          <label for="username">Email or ID</label>
          <input id="username" name="username" type="text" autocomplete="username" placeholder="Enter your email or ID" />
        </div>
        <div class="form-group password-group">
          <label for="password">Password</label>
          <div class="password-input">
            <input id="password" name="password" type="password" autocomplete="current-password" placeholder="Enter your password" />
            <button id="eye-toggle" type="button" class="eye-toggle" aria-label="Show password" aria-pressed="false">
              <span class="eye">
                <span class="eye-ball"></span>
                <span class="eye-lid"></span>
              </span>
            </button>
          </div>
        </div>
        <div class="form-actions">
          <button id="login-btn" type="button" class="btn btn-primary btn-block">Log In</button>
          <button id="guest-login-btn" type="button" class="btn btn-outline btn-block">Log in as Guest</button>
        </div>
        <p class="login-footnote">Authorized members only. Guests may explore limited features.</p>
      </div>
    </section>

    <section class="panel hidden" id="main-menu-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn" data-target="login-panel">&larr; Back to Login</button>
        <div>
          <h2 class="panel-title">Welcome back, <span id="welcome-name">Member</span>!</h2>
          <p class="panel-subtitle">Choose an area below to manage your YSP experience.</p>
        </div>
      </header>
      <div id="dashboard-tiles" class="tile-grid" role="list"></div>
    </section>

    <section class="panel hidden" id="homepage-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn" data-target="login-panel">&larr; Back to Login</button>
        <div>
          <h2 class="panel-title">Homepage</h2>
          <p class="panel-subtitle">Discover the latest highlights from YSP Tagum.</p>
        </div>
      </header>
      <article class="card">
        <h3>About</h3>
        <p id="home-about" class="muted">Loading content…</p>
      </article>
      <div class="grid two">
        <article class="card">
          <h3>Mission</h3>
          <p id="home-mission" class="muted">…</p>
        </article>
        <article class="card">
          <h3>Vision</h3>
          <p id="home-vision" class="muted">…</p>
        </article>
      </div>
      <article class="card">
        <h3>Objectives</h3>
        <ul id="home-objectives" class="bullet-list"></ul>
      </article>
      <article class="card ratio-card">
        <h3>Organizational Chart</h3>
        <div class="ratio ratio-16x9">
          <img id="home-org-chart" src="https://placehold.co/1280x720?text=Organizational+Chart" alt="Organizational chart" />
        </div>
      </article>
      <section class="card" id="projects-section">
        <header class="section-header">
          <h3>Flagship Projects</h3>
        </header>
        <div id="projects-grid" class="grid three"></div>
      </section>
      <section class="grid two" id="contacts-section">
        <article class="card">
          <h3>Report Issues</h3>
          <p class="muted">Reach us for support via Facebook or Email.</p>
          <div class="button-stack">
            <button type="button" class="btn btn-primary" id="contact-facebook">Open Facebook</button>
            <button type="button" class="btn btn-outline" id="contact-email">Compose Email</button>
          </div>
        </article>
        <article class="card">
          <h3>Web App Developer</h3>
          <p id="developer-info" class="muted">Maintained by YSP Tagum Digital Services.</p>
        </article>
      </section>
    </section>

    <section class="panel hidden" id="profile-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Profile &amp; ID</h2>
          <p class="panel-subtitle">Review your account and download your QR ID.</p>
        </div>
      </header>
      <article id="profile-card" class="card profile-card">
        <div class="profile-info">
          <img id="profile-avatar" src="https://placehold.co/400x400?text=Member" alt="Profile avatar" />
          <div>
            <h3 id="profile-name">Member Name</h3>
            <p id="profile-role" class="muted">Role</p>
            <p id="profile-email" class="muted">Email</p>
            <p id="profile-id" class="muted">ID Code</p>
          </div>
        </div>
        <div class="profile-qr">
          <div id="qrid" class="qr-box" aria-live="polite"></div>
          <button id="btn-download-qr" type="button" class="btn btn-outline">Download QR</button>
        </div>
      </article>
    </section>

    <section class="panel hidden" id="qr-attendance-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">QR Attendance</h2>
          <p class="panel-subtitle">Scan members for instant attendance logging.</p>
        </div>
      </header>
      <div class="card">
        <label for="event-select">Active Event</label>
        <select id="event-select"></select>
        <div class="button-row">
          <button id="btn-start-scan" type="button" class="btn btn-primary">Start Scanner</button>
          <button id="btn-stop-scan" type="button" class="btn btn-outline">Stop Scanner</button>
        </div>
        <div id="scanner" class="scanner-box" aria-live="polite"></div>
        <div class="upload-fallback">
          <label for="qr-file">Upload QR Image</label>
          <input id="qr-file" type="file" accept="image/*" />
        </div>
      </div>
      <article class="card">
        <h3>Scan Results</h3>
        <div id="scan-output" class="scan-log" aria-live="polite"></div>
      </article>
    </section>

    <section class="panel hidden" id="manual-attendance-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Manual Attendance</h2>
          <p class="panel-subtitle">Record attendance for members manually.</p>
        </div>
      </header>
      <div class="card">
        <label for="manual-event">Select Event</label>
        <select id="manual-event"></select>
        <div class="form-group">
          <label for="manual-member">Search Member</label>
          <input id="manual-member" type="text" placeholder="Search by name or ID" autocomplete="off" />
        </div>
        <ul id="manual-suggestions" class="suggestions"></ul>
        <div class="button-row">
          <button id="manual-in" type="button" class="btn btn-primary">Time In</button>
          <button id="manual-out" type="button" class="btn btn-outline">Time Out</button>
        </div>
      </div>
    </section>

    <section class="panel hidden" id="attendance-dashboard-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Attendance Dashboard</h2>
          <p class="panel-subtitle">Visualize participation across events.</p>
        </div>
      </header>
      <article class="card">
        <canvas id="kpi-chart" height="320" role="img" aria-label="Attendance KPIs chart"></canvas>
      </article>
    </section>

    <section class="panel hidden" id="attendance-trans-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Attendance Transparency</h2>
          <p class="panel-subtitle">Track your attendance record.</p>
        </div>
      </header>
      <div class="card table-card">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Event</th>
                <th>Time In</th>
                <th>Time Out</th>
              </tr>
            </thead>
            <tbody id="attendance-rows"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="panel hidden" id="manage-events-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Manage Events</h2>
          <p class="panel-subtitle">Create and update YSP events.</p>
        </div>
      </header>
      <div class="card">
        <button id="btn-create-event" type="button" class="btn btn-primary">Create Event</button>
      </div>
      <div class="card table-card">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Event</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="events-rows"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="panel hidden" id="directory-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Officer Directory</h2>
          <p class="panel-subtitle">Find officers and members quickly.</p>
        </div>
      </header>
      <div class="card">
        <label for="search-input">Search Members</label>
        <input id="search-input" type="text" placeholder="Type name or ID" autocomplete="off" />
        <ul id="suggestions-list" class="suggestions" role="listbox"></ul>
      </div>
      <article id="directory-result" class="card profile-card muted">Search to view member details.</article>
    </section>

    <section class="panel hidden" id="announcements-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Announcements</h2>
          <p class="panel-subtitle">Share updates with the YSP community.</p>
        </div>
      </header>
      <div class="card">
        <button id="btn-new-announcement" type="button" class="btn btn-primary">Create Announcement</button>
      </div>
      <div id="announcement-list" class="stack"></div>
    </section>

    <section class="panel hidden" id="submit-feedback-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Submit Feedback</h2>
          <p class="panel-subtitle">Tell us how we can improve.</p>
        </div>
      </header>
      <div class="card">
        <label for="feedback-text">Your Feedback</label>
        <textarea id="feedback-text" rows="6" placeholder="Share your thoughts"></textarea>
        <button id="btn-send-feedback" type="button" class="btn btn-primary">Send Feedback</button>
      </div>
      <section class="card">
        <h3>Your Previous Feedback</h3>
        <div id="my-feedback-list" class="stack"></div>
      </section>
    </section>

    <section class="panel hidden" id="view-feedback-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Feedback Inbox</h2>
          <p class="panel-subtitle">Review submissions from members.</p>
        </div>
      </header>
      <div id="feedback-admin-list" class="stack"></div>
    </section>

    <section class="panel hidden" id="view-logs-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Access Logs</h2>
          <p class="panel-subtitle">Monitor sign-in history for transparency.</p>
        </div>
      </header>
      <div class="card table-card">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>ID Code</th>
                <th>Name</th>
              </tr>
            </thead>
            <tbody id="access-log-rows"></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <div id="modal-root" hidden></div>
  <div id="toast-root" aria-live="polite" aria-atomic="true"></div>

<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  if (!root) {
    return;
  }

  var globalYsp = (root.YSP = root.YSP || {});

  globalYsp.ns = function (path) {
    return String(path || '')
      .split('.')
      .filter(function (segment) {
        return !!segment;
      })
      .reduce(function (acc, key) {
        if (!acc[key]) {
          acc[key] = {};
        }
        return acc[key];
      }, globalYsp);
  };

  function ensureUrl(value, fallback) {
    try {
      var raw = String(value || '').trim();
      if (!raw) {
        return fallback;
      }
      var withProto = /^https?:/i.test(raw) ? raw : 'https://' + raw;
      var parsed = new URL(withProto);
      if (parsed.protocol === 'http:' || parsed.protocol === 'https:') {
        return parsed.toString();
      }
      return fallback;
    } catch (err) {
      return fallback;
    }
  }

  globalYsp.safeUrl = function (value) {
    return ensureUrl(value, '');
  };

  globalYsp.safeImage = function (value) {
    return ensureUrl(value, 'https://placehold.co/960x540?text=YSP');
  };

  var onError = function (msg, src, line, col, err) {
    try {
      if (
        typeof google !== 'undefined' &&
        google.script &&
        google.script.run &&
        typeof google.script.run.logClientError === 'function'
      ) {
        google.script.run.logClientError(String(msg), String(src), Number(line) || 0, Number(col) || 0);
      }
    } catch (loggingError) {
      // ignore logging errors
    }
    if (root.console && typeof root.console.error === 'function') {
      root.console.error('Global JS Error:', msg, 'at', src, line, col, err);
    }
  };

  try {
    root.onerror = onError;
  } catch (assignErr) {
    // ignore inability to assign handler
  }
});
</script>
<script>
(function (root) {
  'use strict';

  if (!root) {
    return;
  }

  var doc = root.document;
  var historyApi = root.history;
  var locationApi = root.location;
  var setTimeoutFn = typeof root.setTimeout === 'function' ? root.setTimeout.bind(root) : function (fn) {
    return fn();
  };

  var globalYsp = (root.YSP = root.YSP || {});
  globalYsp.state = globalYsp.state || { session: null };

  var isReady = false;
  var readyQueue = [];
  var toastTimers = [];
  var toastRoot = null;

  function onReady(fn) {
    if (typeof fn !== 'function') {
      return;
    }
    if (isReady) {
      fn();
    } else {
      readyQueue.push(fn);
    }
  }

  function flushReady() {
    if (isReady) {
      return;
    }
    isReady = true;
    readyQueue.splice(0).forEach(function (fn) {
      try {
        fn();
      } catch (err) {
        console.error('onReady handler failed', err);
      }
    });
  }

  if (doc && doc.readyState === 'loading') {
    doc.addEventListener('DOMContentLoaded', flushReady, { once: true });
  } else if (doc) {
    flushReady();
  }

  function $(selector, scope) {
    var ctx = scope || doc;
    if (!ctx || typeof ctx.querySelector !== 'function') {
      return null;
    }
    return ctx.querySelector(selector);
  }

  function $$(selector, scope) {
    var ctx = scope || doc;
    if (!ctx || typeof ctx.querySelectorAll !== 'function') {
      return [];
    }
    return Array.prototype.slice.call(ctx.querySelectorAll(selector));
  }

  function esc(value) {
    return String(value == null ? '' : value)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
  }

  function resolveFunction(path) {
    if (!path) {
      return null;
    }
    return String(path)
      .split('.')
      .reduce(function (acc, key) {
        if (acc && acc[key] != null) {
          return acc[key];
        }
        return undefined;
      }, root);
  }

  function show(id) {
    if (!id) {
      return;
    }
    var target = doc ? doc.getElementById(id) : null;
    if (!target) {
      console.warn('Panel not found', id);
      return;
    }
    if (doc) {
      $$('.panel').forEach(function (panel) {
        var isTarget = panel === target;
        panel.classList.toggle('active', isTarget);
        panel.classList.toggle('hidden', !isTarget);
      });
    }
    try {
      if (historyApi && typeof historyApi.replaceState === 'function') {
        historyApi.replaceState(null, '', '#' + id);
      } else {
        if (locationApi) {
          locationApi.hash = '#' + id;
        }
      }
    } catch (err) {
      // ignore
    }
    var handlerName = target.getAttribute('data-load');
    var handler = resolveFunction(handlerName);
    if (typeof handler === 'function') {
      try {
        handler(target);
      } catch (err) {
        console.error('Panel load handler failed', handlerName, err);
      }
    }
    if (target && typeof target.dispatchEvent === 'function' && root.CustomEvent) {
      target.dispatchEvent(new root.CustomEvent('panel:show', { detail: { panel: target } }));
    }
  }

  function ensureToastRoot() {
    if (!doc) {
      return null;
    }
    if (!toastRoot) {
      toastRoot = doc.getElementById('toast-root');
      if (!toastRoot && doc.body) {
        toastRoot = doc.createElement('div');
        toastRoot.id = 'toast-root';
        toastRoot.className = 'toast-container';
        doc.body.appendChild(toastRoot);
      }
    }
    if (toastRoot) {
      toastRoot.classList.add('toast-container');
    }
    return toastRoot;
  }

  function toast(message, opts) {
    var root = ensureToastRoot();
    var text = message ? String(message) : 'Action completed.';
    if (!root || !doc) {
      return null;
    }
    var toastEl = doc.createElement('div');
    toastEl.className = 'toast';
    toastEl.textContent = text;
    root.appendChild(toastEl);

    var duration = (opts && opts.duration) || 3200;
    var timer = setTimeoutFn(function () {
      toastEl.classList.add('is-leaving');
      toastEl.addEventListener(
        'transitionend',
        function () {
          toastEl.remove();
        },
        { once: true }
      );
      toastEl.style.opacity = '0';
    }, duration);
    toastTimers.push(timer);
    return toastEl;
  }

  function openSafe(url) {
    try {
      var trimmed = String(url || '').trim();
      if (!trimmed) {
        return;
      }
      var withProto = /^https?:/i.test(trimmed) ? trimmed : 'https://' + trimmed;
      var parsed = new URL(withProto);
      if (parsed.protocol !== 'http:' && parsed.protocol !== 'https:') {
        throw new Error('Invalid protocol');
      }
      var win = root.open ? root.open(parsed.toString(), '_blank', 'noopener') : null;
      if (win) {
        win.opener = null;
      }
    } catch (err) {
      console.warn('Unable to open link', err);
      toast('Cannot open link. Please try again later.');
    }
  }

  function hasServer() {
    return (
      typeof google !== 'undefined' &&
      google.script &&
      google.script.run &&
      typeof google.script.run.withSuccessHandler === 'function'
    );
  }

  function callServer(method, args, onSuccess, onFailure, mock) {
    var params = Array.isArray(args) ? args : [];
    var successHandler = typeof onSuccess === 'function' ? onSuccess : function () {};
    var failureHandler = typeof onFailure === 'function' ? onFailure : function (err) {
      console.error('Server call failed', method, err);
      toast('Something went wrong.');
    };

    if (hasServer()) {
      try {
        var runner = google.script.run
          .withSuccessHandler(function (response) {
            successHandler(response);
          })
          .withFailureHandler(function (error) {
            failureHandler(error);
          });
        if (typeof runner[method] === 'function') {
          runner[method].apply(runner, params);
        } else {
          throw new Error('Method ' + method + ' not found');
        }
      } catch (err) {
        failureHandler(err);
      }
    } else {
      setTimeoutFn(function () {
        if (mock !== undefined) {
          successHandler(mock);
        } else {
          failureHandler(new Error('Offline preview')); 
        }
      }, 150);
    }
  }

  function bindBackButtons() {
    $$('.back-btn').forEach(function (btn) {
      if (btn.dataset.bound === '1') {
        return;
      }
      btn.dataset.bound = '1';
      btn.addEventListener('click', function (event) {
        event.preventDefault();
        var explicit = btn.getAttribute('data-target');
        var parentPanel = btn.closest('.panel');
        var fallback = parentPanel && parentPanel.id === 'homepage-panel' ? 'login-panel' : 'main-menu-panel';
        var target = explicit || fallback;
        if (parentPanel && parentPanel.id === 'homepage-panel') {
          // ensure homepage back always returns to login
          target = 'login-panel';
        }
        if (btn.id === 'logout-btn') {
          target = 'login-panel';
        }
        show(target);
      });
    });
  }

  root.onReady = onReady;
  root.$ = $;
  root.$$ = $$;
  root.esc = esc;
  root.show = show;
  root.toast = toast;
  root.openSafe = openSafe;
  root.bindBackButtons = bindBackButtons;
  globalYsp.utils = globalYsp.utils || {};
  globalYsp.utils.callServer = callServer;
  globalYsp.utils.hasServer = hasServer;
  globalYsp.utils.resolveFunction = resolveFunction;
})(typeof window !== 'undefined' ? window : typeof globalThis !== 'undefined' ? globalThis : null);
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  if (!root || !root.document) {
    return;
  }

  var doc = root.document;
  var body = doc.body || doc.documentElement;
  var modalRoot = null;
  var lastFocused = null;
  var trapHandler = null;
  var setTimeoutFn = typeof root.setTimeout === 'function' ? root.setTimeout.bind(root) : function (fn) {
    fn();
  };

  function ensureRoot() {
    if (!modalRoot) {
      modalRoot = doc.getElementById('modal-root');
      if (!modalRoot) {
        modalRoot = doc.createElement('div');
        modalRoot.id = 'modal-root';
        modalRoot.className = 'modal-root';
        modalRoot.hidden = true;
        if (body && typeof body.appendChild === 'function') {
          body.appendChild(modalRoot);
        }
      }
    }
    if (modalRoot) {
      modalRoot.classList.add('modal-root');
    }
    return modalRoot;
  }

  function focusables(panel) {
    var selectors =
      'a[href], area[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])';
    if (!panel || typeof panel.querySelectorAll !== 'function') {
      return [];
    }
    var nodes = panel.querySelectorAll(selectors);
    var items = [];
    for (var i = 0; i < nodes.length; i += 1) {
      if (nodes[i].offsetParent !== null || nodes[i] === panel) {
        items.push(nodes[i]);
      }
    }
    if (!items.length) {
      panel.setAttribute('tabindex', '-1');
      items.push(panel);
    }
    return items;
  }

  function trapFocus(panel) {
    var items = focusables(panel);
    if (!items.length) {
      return;
    }
    var first = items[0];
    var last = items[items.length - 1];
    trapHandler = function (event) {
      if (event.key !== 'Tab') {
        return;
      }
      if (event.shiftKey) {
        if (doc.activeElement === first) {
          event.preventDefault();
          last.focus();
        }
      } else if (doc.activeElement === last) {
        event.preventDefault();
        first.focus();
      }
    };
    panel.addEventListener('keydown', trapHandler);
    setTimeoutFn(function () {
      if (first && typeof first.focus === 'function') {
        first.focus();
      }
    }, 20);
  }

  function removeTrap(panel) {
    if (panel && trapHandler) {
      panel.removeEventListener('keydown', trapHandler);
    }
    trapHandler = null;
  }

  function closeModal(opts) {
    if (!modalRoot) {
      return;
    }
    var skipRestore = opts && opts.skipFocusRestore;
    var panel = modalRoot.querySelector('.modal__panel');
    removeTrap(panel);
    modalRoot.innerHTML = '';
    modalRoot.hidden = true;
    if (body) {
      body.style.overflow = '';
    }
    if (!skipRestore && lastFocused && typeof lastFocused.focus === 'function') {
      try {
        lastFocused.focus();
      } catch (err) {
        // ignore focus errors
      }
    }
    lastFocused = null;
  }

  function showModal(config) {
    if (!doc || !body) {
      return null;
    }
    var options = config || {};
    ensureRoot();
    modalRoot.innerHTML = '';
    modalRoot.hidden = false;
    if (body) {
      body.style.overflow = 'hidden';
    }
    lastFocused = options.opener || doc.activeElement;

    var backdrop = doc.createElement('div');
    backdrop.className = 'modal-backdrop is-open';
    var modal = doc.createElement('div');
    modal.className = 'modal is-open';
    modal.setAttribute('role', 'dialog');
    modal.setAttribute('aria-modal', 'true');

    var panel = doc.createElement('div');
    panel.className = 'modal__panel';

    var header = doc.createElement('div');
    header.className = 'modal__header';
    var title = doc.createElement('h2');
    title.className = 'modal__title';
    title.textContent = options.title || 'Dialog';
    var closeBtn = doc.createElement('button');
    closeBtn.type = 'button';
    closeBtn.className = 'modal__close';
    closeBtn.setAttribute('aria-label', 'Close dialog');
    closeBtn.innerHTML = '&times;';
    closeBtn.dataset.close = '1';
    header.appendChild(title);
    header.appendChild(closeBtn);

    var bodySection = doc.createElement('div');
    bodySection.className = 'modal__body';
    bodySection.innerHTML = options.bodyHtml || '';

    var footer = doc.createElement('div');
    footer.className = 'modal__footer';
    footer.innerHTML = options.footerHtml || '<button type="button" class="btn btn-outline" data-close="1">Close</button>';

    panel.appendChild(header);
    panel.appendChild(bodySection);
    panel.appendChild(footer);
    modal.appendChild(panel);
    modalRoot.appendChild(backdrop);
    modalRoot.appendChild(modal);

    var closeElements = modalRoot.querySelectorAll('[data-close]');
    closeElements.forEach(function (btn) {
      btn.addEventListener('click', function () {
        closeModal({ skipFocusRestore: !!btn.dataset.skipRestore });
      });
    });

    backdrop.addEventListener('click', function (event) {
      if (event.target === backdrop) {
        closeModal();
      }
    });

    function escListener(event) {
      if (event.key === 'Escape') {
        event.preventDefault();
        closeModal();
        doc.removeEventListener('keydown', escListener);
      }
    }

    doc.addEventListener('keydown', escListener);

    trapFocus(panel);

    return panel;
  }

  var globalYsp = (root.YSP = root.YSP || {});
  globalYsp.modal = globalYsp.modal || {};
  globalYsp.modal.showModal = showModal;
  globalYsp.modal.closeModal = closeModal;

  root.showModal = showModal;
  root.closeModal = closeModal;
});
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  if (!root || !root.document) {
    return;
  }

  var doc = root.document;
  var YSP = (root.YSP = root.YSP || {});
  YSP.state = YSP.state || { session: null };
  var utils = (YSP.utils = YSP.utils || {});
  var callServer = typeof utils.callServer === 'function' ? utils.callServer : function () {};
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};
  var showFn = typeof root.show === 'function' ? root.show : function () {};
  var showModalFn = typeof root.showModal === 'function' ? root.showModal : function () { return doc.createElement('div'); };
  var closeModalFn = typeof root.closeModal === 'function' ? root.closeModal : function () {};
  var select = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var escFn = typeof root.esc === 'function'
    ? root.esc
    : function (value) {
        return String(value == null ? '' : value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      };
  var setTimeoutFn = typeof root.setTimeout === 'function' ? root.setTimeout.bind(root) : function (fn) {
    fn();
  };
  var bindDirectoryFn = typeof root.bindDirectory === 'function' ? root.bindDirectory : function () {};
  var bindManualAttendanceFn = typeof root.bindManualAttendance === 'function' ? root.bindManualAttendance : function () {};
  var setupManualAttendanceFn = typeof root.setupManualAttendance === 'function' ? root.setupManualAttendance : function () {};
  var setupQrAttendanceFn = typeof root.setupQrAttendance === 'function' ? root.setupQrAttendance : function () {};
  var loadHomepageFn = typeof root.loadHomepage === 'function' ? root.loadHomepage : function () {};
  var loadMyAttendanceFn = typeof root.loadMyAttendance === 'function' ? root.loadMyAttendance : function () {};
  var loadKpisFn = typeof root.loadKpis === 'function' ? root.loadKpis : function () {};
  var loadEventsFn = typeof root.loadEvents === 'function' ? root.loadEvents : function () {};
  var loadAnnouncementsFn = typeof root.loadAnnouncements === 'function' ? root.loadAnnouncements : function () {};
  var loadMyFeedbackFn = typeof root.loadMyFeedback === 'function' ? root.loadMyFeedback : function () {};
  var loadFeedbackAdminFn = typeof root.loadFeedbackAdmin === 'function' ? root.loadFeedbackAdmin : function () {};
  var loadAccessLogsFn = typeof root.loadAccessLogs === 'function' ? root.loadAccessLogs : function () {};

  var loginBound = false;
  var qrCodeInstance = null;

  function normalizeName(name) {
    var value = String(name || '').trim();
    if (!value) {
      return 'Member';
    }
    return value.replace(/\s+/g, ' ');
  }

  function getRole(user) {
    var role = user && (user.role || user.position || user.type);
    return role ? String(role).toLowerCase() : '';
  }

  function isGuest(user) {
    var role = getRole(user);
    return role === 'guest' || role === 'visitor' || !!(user && user.isGuest);
  }

  function bindLogin() {
    if (loginBound) {
      return;
    }
    loginBound = true;
    var usernameInput = select('#username');
    var passwordInput = select('#password');
    var loginBtn = select('#login-btn');
    var guestBtn = select('#guest-login-btn');
    var eyeToggle = select('#eye-toggle');

    function toggleEye() {
      if (!passwordInput || !eyeToggle) {
        return;
      }
      var reveal = passwordInput.getAttribute('type') === 'password';
      passwordInput.setAttribute('type', reveal ? 'text' : 'password');
      eyeToggle.setAttribute('aria-pressed', reveal ? 'true' : 'false');
      eyeToggle.classList.toggle('is-visible', reveal);
      eyeToggle.classList.add('is-animating');
      setTimeoutFn(function () {
        eyeToggle.classList.remove('is-animating');
      }, 350);
    }

    if (eyeToggle) {
      eyeToggle.addEventListener('click', function () {
        toggleEye();
      });
    }

    function handleSubmit(event) {
      if (event && event.key === 'Enter') {
        event.preventDefault();
        doLogin();
      }
    }

    if (usernameInput) {
      usernameInput.addEventListener('keydown', handleSubmit);
    }
    if (passwordInput) {
      passwordInput.addEventListener('keydown', handleSubmit);
    }
    if (loginBtn) {
      loginBtn.addEventListener('click', function () {
        doLogin();
      });
    }
    if (guestBtn) {
      guestBtn.addEventListener('click', function () {
        openGuestModal(guestBtn);
      });
    }
  }

  function openGuestModal(opener) {
    var panel = showModalFn({
      title: 'Guest Login',
      opener: opener,
      bodyHtml:
        '<p>Enter your name so we can personalize your visit.</p>' +
        '<label class="form-group">Name<input id="guest-name" type="text" placeholder="Your name" /></label>',
      footerHtml:
        '<button type="button" class="btn btn-outline" data-close="1">Cancel</button>' +
        '<button type="button" class="btn btn-primary" id="guest-submit">Continue</button>',
    });
    if (!panel || typeof panel.querySelector !== 'function') {
      return;
    }
    var input = panel.querySelector('#guest-name');
    var submit = panel.querySelector('#guest-submit');

    function submitGuest() {
      var name = normalizeName(input && input.value);
      if (!name) {
        toastFn('Please enter your name.');
        return;
      }
      if (submit) {
        submit.disabled = true;
      }
      callServer(
        'guestLogin',
        [name],
        function (res) {
          if (submit) {
            submit.disabled = false;
          }
          closeModalFn();
          if (res && res.success && res.user) {
            res.user.isGuest = true;
            setSession(res.user);
            showFn('homepage-panel');
            loadHomepageFn();
          } else {
            toastFn((res && res.message) || 'Unable to start guest session.');
          }
        },
        function (err) {
          if (submit) {
            submit.disabled = false;
          }
          toastFn('Guest login failed.');
          if (root.console && typeof root.console.error === 'function') {
            root.console.error(err);
          }
        },
        { success: true, user: { name: name, role: 'Guest', isGuest: true } }
      );
    }

    if (submit) {
      submit.addEventListener('click', submitGuest);
    }
    if (input) {
      input.addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
          event.preventDefault();
          submitGuest();
        }
      });
      setTimeoutFn(function () {
        if (typeof input.focus === 'function') {
          input.focus();
        }
      }, 20);
    }
  }

  function doLogin() {
    var usernameInput = select('#username');
    var passwordInput = select('#password');
    var loginBtn = select('#login-btn');
    var username = usernameInput ? usernameInput.value.trim() : '';
    var password = passwordInput ? passwordInput.value.trim() : '';
    if (!username || !password) {
      toastFn('Enter both username and password.');
      return;
    }
    if (loginBtn) {
      loginBtn.disabled = true;
    }
    callServer(
      'validateLogin',
      [username, password],
      function (res) {
        if (loginBtn) {
          loginBtn.disabled = false;
        }
        if (res && res.success && res.user) {
          setSession(res.user);
          showFn('main-menu-panel');
        } else {
          toastFn((res && res.message) || 'Invalid credentials.');
        }
      },
      function (err) {
        if (loginBtn) {
          loginBtn.disabled = false;
        }
        toastFn('Login failed. Please try again.');
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
      },
      {
        success: true,
        user: {
          name: username.split('@')[0] || 'Member',
          email: username,
          role: 'Member',
          id: 'YSP-0000',
        },
      }
    );
  }

  function setSession(user) {
    var safeUser = user || {};
    YSP.state.session = safeUser;
    root.__SESSION__ = safeUser;
    var welcome = select('#welcome-name');
    if (welcome) {
      welcome.textContent = normalizeName(safeUser.name || safeUser.fullName || 'Member');
    }
    var passwordInput = select('#password');
    if (passwordInput) {
      passwordInput.value = '';
      passwordInput.setAttribute('type', 'password');
    }
    var usernameInput = select('#username');
    if (usernameInput) {
      usernameInput.value = safeUser.email || '';
    }
    var eyeToggle = select('#eye-toggle');
    if (eyeToggle) {
      eyeToggle.classList.remove('is-visible');
      eyeToggle.setAttribute('aria-pressed', 'false');
    }
    buildDashboard(safeUser);
    buildProfile(safeUser);
    loadHomepageFn();
    bindDirectoryFn();
    bindManualAttendanceFn();
  }

  function buildDashboard(user) {
    var tilesRoot = select('#dashboard-tiles');
    if (!tilesRoot || !doc) {
      return;
    }
    tilesRoot.innerHTML = '';
    var dashboardConfig = [
      { id: 'home', label: 'Homepage', description: 'News, mission, projects and contacts.', icon: '🏠', target: 'homepage-panel', action: loadHomepageFn },
      { id: 'profile', label: 'Profile & QR ID', description: 'View your membership details.', icon: '🪪', target: 'profile-panel', action: function () { buildProfile(user); } },
      { id: 'qr-scan', label: 'QR Attendance', description: 'Scan member QR codes for events.', icon: '📷', target: 'qr-attendance-panel', action: setupQrAttendanceFn },
      { id: 'manual', label: 'Manual Attendance', description: 'Search members and record attendance.', icon: '📝', target: 'manual-attendance-panel', action: function () { setupManualAttendanceFn(); bindManualAttendanceFn(); } },
      { id: 'kpi', label: 'Attendance Dashboard', description: 'Charts of attendance trends.', icon: '📊', target: 'attendance-dashboard-panel', action: loadKpisFn },
      { id: 'transparency', label: 'Attendance Transparency', description: 'Your attendance records.', icon: '📅', target: 'attendance-trans-panel', action: loadMyAttendanceFn },
      { id: 'events', label: 'Manage Events', description: 'Create and manage activities.', icon: '🎪', target: 'manage-events-panel', action: loadEventsFn },
      { id: 'directory', label: 'Directory', description: 'Find officers and members.', icon: '🧑‍🤝‍🧑', target: 'directory-panel', action: bindDirectoryFn },
      { id: 'announcements', label: 'Announcements', description: 'Publish updates to members.', icon: '📣', target: 'announcements-panel', action: loadAnnouncementsFn },
      { id: 'feedback', label: 'Submit Feedback', description: 'Share your thoughts with the council.', icon: '💬', target: 'submit-feedback-panel', action: loadMyFeedbackFn },
      { id: 'feedback-admin', label: 'Feedback Inbox', description: 'Review feedback submissions.', icon: '📥', target: 'view-feedback-panel', action: loadFeedbackAdminFn },
      { id: 'access-logs', label: 'Access Logs', description: 'Monitor sign-in activity.', icon: '🗒️', target: 'view-logs-panel', action: loadAccessLogsFn },
    ];

    var allowedTargets;
    if (isGuest(user)) {
      allowedTargets = {
        'homepage-panel': true,
        'directory-panel': true,
        'submit-feedback-panel': true,
        'attendance-trans-panel': true,
      };
    }

    dashboardConfig
      .filter(function (config) {
        if (!allowedTargets) {
          return true;
        }
        return !!allowedTargets[config.target];
      })
      .forEach(function (config) {
        var tile = doc.createElement('button');
        tile.type = 'button';
        tile.className = 'tile';
        tile.setAttribute('role', 'listitem');
        tile.innerHTML =
          '<span class="tile-icon" aria-hidden="true">' +
          config.icon +
          '</span>' +
          '<span class="tile-title">' +
          escFn(config.label) +
          '</span>' +
          '<span class="muted">' +
          escFn(config.description) +
          '</span>';
        tile.addEventListener('click', function () {
          try {
            if (typeof config.action === 'function') {
              config.action();
            }
          } catch (err) {
            if (root.console && typeof root.console.error === 'function') {
              root.console.error('Tile action failed', config.id, err);
            }
          }
          showFn(config.target);
        });
        tilesRoot.appendChild(tile);
      });

    var logoutTile = doc.createElement('button');
    logoutTile.type = 'button';
    logoutTile.className = 'tile';
    logoutTile.id = 'logout-tile';
    logoutTile.innerHTML =
      '<span class="tile-icon" aria-hidden="true">🚪</span>' +
      '<span class="tile-title">Log Out</span>' +
      '<span class="muted">Sign out from this device.</span>';
    logoutTile.addEventListener('click', function () {
      performLogout();
    });
    tilesRoot.appendChild(logoutTile);
  }

  function performLogout() {
    callServer(
      'logout',
      [],
      function () {
        YSP.state.session = null;
        root.__SESSION__ = null;
        var usernameInput = select('#username');
        if (usernameInput) {
          usernameInput.value = '';
        }
        var passwordInput = select('#password');
        if (passwordInput) {
          passwordInput.value = '';
          passwordInput.setAttribute('type', 'password');
        }
        var eyeToggle = select('#eye-toggle');
        if (eyeToggle) {
          eyeToggle.classList.remove('is-visible');
          eyeToggle.setAttribute('aria-pressed', 'false');
        }
        showFn('login-panel');
        toastFn('Signed out successfully.');
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to log out right now.');
      },
      { success: true }
    );
  }

  function buildProfile(user) {
    var profileName = select('#profile-name');
    var profileRole = select('#profile-role');
    var profileEmail = select('#profile-email');
    var profileId = select('#profile-id');
    var avatar = select('#profile-avatar');
    var qrContainer = select('#qrid');
    var downloadBtn = select('#btn-download-qr');

    if (!qrContainer || !doc) {
      return;
    }

    if (profileName) {
      profileName.textContent = normalizeName(user && (user.fullName || user.name));
    }
    if (profileRole) {
      profileRole.textContent = user && (user.role || user.position || 'Member');
    }
    if (profileEmail) {
      profileEmail.textContent = user && (user.email || 'no-email@ysp.org');
    }
    if (profileId) {
      profileId.textContent = user && (user.id || user.memberId || 'ID unavailable');
    }
    if (avatar) {
      var avatarUrl = (user && user.avatarUrl) || 'https://placehold.co/400x400?text=Member';
      avatar.src = avatarUrl;
    }

    qrContainer.innerHTML = '';
    var QRCodeCtor = root.QRCode;
    if (typeof QRCodeCtor === 'function') {
      qrCodeInstance = new QRCodeCtor(qrContainer, {
        text: String(user && (user.id || user.memberId || user.email || 'YSP')),
        width: 180,
        height: 180,
        colorDark: '#1d1d1f',
        colorLight: '#ffffff',
      });
    } else {
      qrContainer.textContent = 'QR generator unavailable.';
    }

    if (downloadBtn && downloadBtn.dataset.bound !== '1') {
      downloadBtn.dataset.bound = '1';
      downloadBtn.addEventListener('click', function () {
        var canvas = qrContainer.querySelector('canvas');
        var img = qrContainer.querySelector('img');
        var href = null;
        if (canvas && canvas.toDataURL) {
          href = canvas.toDataURL('image/png');
        } else if (img && img.src) {
          href = img.src;
        }
        if (!href) {
          toastFn('QR image not ready yet.');
          return;
        }
        var link = doc.createElement('a');
        link.href = href;
        link.download = (user && user.id ? user.id : 'ysp-id') + '-qr.png';
        if (doc.body) {
          doc.body.appendChild(link);
          if (typeof link.click === 'function') {
            link.click();
          }
          link.remove();
        }
      });
    }
  }

  YSP.login = YSP.login || {};
  YSP.login.bindLogin = bindLogin;
  YSP.login.doLogin = doLogin;
  YSP.login.setSession = setSession;
  YSP.login.buildDashboard = buildDashboard;
  YSP.login.buildProfile = buildProfile;

  root.bindLogin = bindLogin;
  root.doLogin = doLogin;
  root.setSession = setSession;
  root.buildDashboard = buildDashboard;
  root.buildProfile = buildProfile;
});
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  if (!root) {
    return;
  }

  if (!root.document) {
    root.loadHomepage = root.loadHomepage || function () {};
    root.renderHome = root.renderHome || function () {};
    root.deriveProjectsFromFlat = root.deriveProjectsFromFlat || function () { return []; };
    root.renderProjects = root.renderProjects || function () {};
    root.openProjectModal = root.openProjectModal || function () {};
    root.renderContacts = root.renderContacts || function () {};
    return;
  }

  var doc = root.document;
  var YSP = (root.YSP = root.YSP || {});
  var utils = (YSP.utils = YSP.utils || {});
  var callServer = typeof utils.callServer === 'function' ? utils.callServer : function () {};
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};
  var showModalFn = typeof root.showModal === 'function' ? root.showModal : function () { return doc.createElement('div'); };
  var closeModalFn = typeof root.closeModal === 'function' ? root.closeModal : function () {};
  var $ = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var escFn = typeof root.esc === 'function'
    ? root.esc
    : function (value) {
        return String(value == null ? '' : value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      };

  var state = {
    loaded: false,
    data: null,
  };

  function loadHomepage(force) {
    if (state.loaded && !force) {
      renderHome(state.data || {});
      return;
    }
    callServer(
      'getHomepageContent',
      [],
      function (res) {
        var payload = res && (res.data || res.home || res);
        state.loaded = true;
        state.data = payload || {};
        renderHome(payload || {});
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load homepage right now.');
        renderHome(state.data || {});
      },
      {
        success: true,
        data: {
          about: 'Youth and Students for Peace (YSP) Tagum unites servant leaders dedicated to community impact.',
          mission: 'To cultivate character, compassion, and competence among emerging leaders.',
          vision: 'A generation of empowered youth creating sustainable peace initiatives.',
          objectives: [
            'Lead meaningful volunteer opportunities.',
            'Strengthen partnerships with local communities.',
            'Provide leadership development programs.',
          ],
          orgChartUrl: 'https://placehold.co/1280x720?text=YSP+Org+Chart',
          facebookUrl: 'https://www.facebook.com',
          email: 'ysp.tagum@gmail.com',
          developer: 'Built by YSP Tagum Digital Services.',
          projects: [
            {
              title: 'Peace Camp',
              description: 'A youth leadership training focused on mediation and collaboration.',
              imageUrl: 'https://placehold.co/640x360?text=Peace+Camp',
            },
            {
              title: 'Community Cleanup',
              description: 'Mobilizing volunteers to beautify key barangays.',
              imageUrl: 'https://placehold.co/640x360?text=Cleanup+Drive',
            },
          ],
        },
      }
    );
  }

  function renderHome(home) {
    var aboutEl = $('#home-about');
    var missionEl = $('#home-mission');
    var visionEl = $('#home-vision');
    var objectivesEl = $('#home-objectives');
    var orgChart = $('#home-org-chart');
    var developerInfo = $('#developer-info');

    if (aboutEl) {
      aboutEl.textContent = home && home.about ? home.about : 'Welcome to YSP Tagum.';
    }
    if (missionEl) {
      missionEl.textContent = home && home.mission ? home.mission : 'Mission will appear here.';
    }
    if (visionEl) {
      visionEl.textContent = home && home.vision ? home.vision : 'Vision will appear here.';
    }
    if (objectivesEl) {
      objectivesEl.innerHTML = '';
      var objectives = Array.isArray(home && home.objectives) ? home.objectives : [];
      if (!objectives.length && home && typeof home.objectives === 'string') {
        objectives = home.objectives.split(/\n+/);
      }
      if (!objectives.length) {
        objectives = ['Promote peace initiatives.', 'Develop youth leadership skills.'];
      }
      objectives.forEach(function (item) {
        if (!doc || typeof doc.createElement !== 'function') {
          return;
        }
        var li = doc.createElement('li');
        li.textContent = item;
        objectivesEl.appendChild(li);
      });
    }
    if (orgChart) {
      orgChart.src = YSP.safeImage ? YSP.safeImage(home && home.orgChartUrl) : (home && home.orgChartUrl) || orgChart.src;
    }
    if (developerInfo) {
      developerInfo.textContent = (home && home.developer) || 'Maintained by YSP Tagum Digital Services.';
    }

    renderProjects(deriveProjectsFromFlat(home));
    renderContacts(home);
  }

  function deriveProjectsFromFlat(map) {
    if (!map) {
      return [];
    }
    if (Array.isArray(map.projects)) {
      return map.projects;
    }
    var projects = [];
    for (var key in map) {
      if (!Object.prototype.hasOwnProperty.call(map, key)) {
        continue;
      }
      var match = key.match(/^project(ImageUrl|Desc|Title)_(\d+)/i);
      if (match) {
        var index = Number(match[2]);
        projects[index] = projects[index] || {};
        if (/image/i.test(match[1])) {
          projects[index].imageUrl = map[key];
        } else if (/desc/i.test(match[1])) {
          projects[index].description = map[key];
        } else if (/title/i.test(match[1])) {
          projects[index].title = map[key];
        }
      }
    }
    return projects.filter(function (project) {
      return project && (project.title || project.description || project.imageUrl);
    });
  }

  function renderProjects(projects) {
    var grid = $('#projects-grid');
    if (!grid) {
      return;
    }
    grid.innerHTML = '';
    if (!projects || !projects.length) {
      grid.innerHTML = '<p class="muted">Projects will appear here soon.</p>';
      return;
    }
    projects.forEach(function (project) {
      if (!doc || typeof doc.createElement !== 'function') {
        return;
      }
      var card = doc.createElement('button');
      card.type = 'button';
      card.className = 'project-card';
      card.innerHTML =
        '<img src="' +
        escFn(project.imageUrl || 'https://placehold.co/640x360?text=YSP+Project') +
        '" alt="' +
        escFn(project.title || 'YSP Project') +
        '" />' +
        '<div class="project-body">' +
        '<h4>' +
        escFn(project.title || 'YSP Initiative') +
        '</h4>' +
        '<p>' +
        escFn(project.description || 'More details coming soon.') +
        '</p>' +
        '</div>';
      card.addEventListener('click', function (event) {
        openProjectModal(project, event && event.currentTarget);
      });
      grid.appendChild(card);
    });
  }

  function openProjectModal(project, opener) {
    if (!project) {
      return;
    }
    var safeProject = project || {};
    var panel = showModalFn({
      title: safeProject.title || 'Project Details',
      opener: opener,
      bodyHtml:
        '<div class="ratio ratio-16x9 modal-image">' +
        '<img src="' +
        escFn(safeProject.imageUrl || 'https://placehold.co/960x540?text=YSP+Project') +
        '" alt="' +
        escFn(safeProject.title || 'Project image') +
        '" />' +
        '</div>' +
        '<p class="muted">' +
        escFn(safeProject.description || 'Project description will appear here.') +
        '</p>',
      footerHtml: '<button type="button" class="btn btn-primary" data-close="1">Close</button>',
    });
    return panel;
  }

  function renderContacts(home) {
    var issuesCard = $('#contact-issues');
    var developerCard = $('#contact-developer');
    if (!issuesCard && !developerCard) {
      return;
    }
    if (issuesCard) {
      var fbUrl = YSP.safeUrl ? YSP.safeUrl(home && home.facebookUrl) : home && home.facebookUrl;
      var email = home && home.email ? String(home.email).trim() : '';
      var mailUrl = email
        ? 'https://mail.google.com/mail/?view=cm&fs=1&to=' +
          encodeURIComponent(email) +
          '&su=%5BYSP%5D%20Issue%20Report'
        : '';
      issuesCard.innerHTML =
        '<h3>Report Issues</h3>' +
        '<p class="muted">Need help with the web app? Contact us.</p>' +
        '<div class="btn-group">' +
        '<button type="button" class="btn btn-primary" id="btn-contact-fb">Facebook</button>' +
        '<button type="button" class="btn btn-outline" id="btn-contact-email">Email</button>' +
        '</div>';
      var fbBtn = $('#btn-contact-fb', issuesCard);
      if (fbBtn) {
        fbBtn.addEventListener('click', function () {
          if (fbUrl) {
            root.openSafe ? root.openSafe(fbUrl) : root.open(fbUrl, '_blank');
          } else {
            toastFn('Facebook link unavailable.');
          }
        });
      }
      var emailBtn = $('#btn-contact-email', issuesCard);
      if (emailBtn) {
        emailBtn.addEventListener('click', function () {
          if (mailUrl) {
            root.openSafe ? root.openSafe(mailUrl) : root.open(mailUrl, '_blank');
          } else {
            toastFn('Email unavailable.');
          }
        });
      }
    }
    if (developerCard) {
      developerCard.innerHTML =
        '<h3>Web App Developer</h3>' +
        '<p class="muted">' +
        escFn((home && home.developer) || 'Maintained by YSP Tagum Digital Services.') +
        '</p>';
    }
  }

  YSP.homepage = YSP.homepage || {};
  YSP.homepage.loadHomepage = loadHomepage;
  YSP.homepage.renderHome = renderHome;
  YSP.homepage.deriveProjectsFromFlat = deriveProjectsFromFlat;
  YSP.homepage.renderProjects = renderProjects;
  YSP.homepage.openProjectModal = openProjectModal;
  YSP.homepage.renderContacts = renderContacts;

  root.loadHomepage = loadHomepage;
  root.renderHome = renderHome;
  root.deriveProjectsFromFlat = deriveProjectsFromFlat;
  root.renderProjects = renderProjects;
  root.openProjectModal = openProjectModal;
  root.renderContacts = renderContacts;
});
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  if (!root) {
    return;
  }

  if (!root.document) {
    root.bindDirectory = root.bindDirectory || function () {};
    root.openOfficer = root.openOfficer || function () {};
    return;
  }

  var doc = root.document;
  var $ = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};
  var escFn = typeof root.esc === 'function'
    ? root.esc
    : function (value) {
        return String(value == null ? '' : value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      };
  var setTimeoutFn = typeof root.setTimeout === 'function' ? root.setTimeout.bind(root) : function (fn) {
    fn();
  };
  var clearTimeoutFn = typeof root.clearTimeout === 'function' ? root.clearTimeout.bind(root) : function () {};
  var callServer = root.YSP && root.YSP.utils && typeof root.YSP.utils.callServer === 'function'
    ? root.YSP.utils.callServer
    : function () {};

  var bound = false;
  var debounceTimer = null;
  var suggestionsCache = {};

  function bindDirectory() {
    if (bound) {
      return;
    }
    var input = $('#search-input');
    var list = $('#suggestions-list');
    if (!input || !list) {
      return;
    }
    bound = true;
    input.addEventListener('input', function () {
      var query = input.value.trim();
      clearTimeoutFn(debounceTimer);
      debounceTimer = setTimeoutFn(function () {
        fetchSuggestions(query);
      }, query ? 200 : 0);
    });
    list.addEventListener('click', function (event) {
      var target = event.target && event.target.closest ? event.target.closest('li[data-id]') : null;
      if (!target) {
        return;
      }
      var id = target.getAttribute('data-id');
      openOfficer(id);
      list.innerHTML = '';
      input.value = target.getAttribute('data-label') || input.value;
    });
  }

  function fetchSuggestions(query) {
    var list = $('#suggestions-list');
    if (!list) {
      return;
    }
    if (!query) {
      list.innerHTML = '';
      return;
    }
    if (suggestionsCache[query]) {
      renderSuggestions(suggestionsCache[query]);
      return;
    }
    callServer(
      'officerSuggestions',
      [query],
      function (res) {
        var suggestions = (res && res.data) || res || [];
        suggestionsCache[query] = suggestions;
        renderSuggestions(suggestions);
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to fetch suggestions.');
      },
      [{ id: 'YSP0001', name: 'Juan Dela Cruz', role: 'Officer' }]
    );
  }

  function renderSuggestions(items) {
    var list = $('#suggestions-list');
    if (!list) {
      return;
    }
    list.innerHTML = '';
    if (!items || !items.length) {
      return;
    }
    items.forEach(function (item) {
      if (!doc || typeof doc.createElement !== 'function') {
        return;
      }
      var li = doc.createElement('li');
      var name = item.name || item.fullName || 'Member';
      var id = item.id || item.memberId || item.code;
      li.dataset.id = id;
      li.dataset.label = name;
      li.innerHTML = '<strong>' + escFn(name) + '</strong><span class="muted">' + escFn(id || '') + '</span>';
      list.appendChild(li);
    });
  }

  function openOfficer(id) {
    if (!id) {
      toastFn('Select a member from the list.');
      return;
    }
    var result = $('#directory-result');
    if (result) {
      result.textContent = 'Loading member details…';
    }
    callServer(
      'getRecordById',
      [id],
      function (res) {
        var record = (res && res.data) || res || {};
        renderOfficer(record);
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load member details.');
      },
      {
        id: id,
        name: 'Sample Member',
        role: 'Officer',
        email: 'sample@ysp.org',
        avatarUrl: 'https://placehold.co/600x400?text=Officer',
      }
    );
  }

  function renderOfficer(officer) {
    var result = $('#directory-result');
    if (!result) {
      return;
    }
    result.classList.remove('muted');
    result.innerHTML =
      '<div class="profile-info">' +
      '<img src="' +
      escFn(officer.avatarUrl || 'https://placehold.co/400x400?text=Member') +
      '" alt="' +
      escFn(officer.name || officer.fullName || 'Member') +
      '" />' +
      '<div>' +
      '<h3>' +
      escFn(officer.name || officer.fullName || 'Member') +
      '</h3>' +
      '<p class="muted">' +
      escFn(officer.role || officer.position || 'Member') +
      '</p>' +
      '<p class="muted">' +
      escFn(officer.email || 'No email provided') +
      '</p>' +
      '<p class="muted">' +
      escFn(officer.id || officer.memberId || '') +
      '</p>' +
      '</div>' +
      '</div>';
  }

  root.YSP = root.YSP || {};
  root.YSP.directory = root.YSP.directory || {};
  root.YSP.directory.bindDirectory = bindDirectory;
  root.YSP.directory.openOfficer = openOfficer;

  root.bindDirectory = bindDirectory;
  root.openOfficer = openOfficer;
});
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  if (!root) {
    return;
  }

  if (!root.document) {
    root.setupQrAttendance = root.setupQrAttendance || function () {};
    root.startScanner = root.startScanner || function () {};
    root.stopScanner = root.stopScanner || function () {};
    root.onScan = root.onScan || function () {};
    root.onScanError = root.onScanError || function () {};
    return;
  }

  var $ = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};
  var callServer = root.YSP && root.YSP.utils && typeof root.YSP.utils.callServer === 'function'
    ? root.YSP.utils.callServer
    : function () {};

  var html5Scanner = null;
  var scannerRunning = false;
  var bound = false;

  function setupQrAttendance() {
    if (typeof root.populateActiveEvents === 'function') {
      root.populateActiveEvents('#event-select');
    }
    var output = $('#scan-output');
    if (output) {
      output.innerHTML = '';
    }
    var fileInput = $('#qr-file');
    if (fileInput && fileInput.dataset.bound !== '1') {
      fileInput.dataset.bound = '1';
      fileInput.addEventListener('change', function (event) {
        var file = event.target.files && event.target.files[0];
        if (!file) {
          return;
        }
        decodeFile(file);
        event.target.value = '';
      });
    }
    if (!bound) {
      bound = true;
      var startBtn = $('#btn-start-scan');
      var stopBtn = $('#btn-stop-scan');
      if (startBtn) {
        startBtn.addEventListener('click', startScanner);
      }
      if (stopBtn) {
        stopBtn.addEventListener('click', stopScanner);
      }
    }
  }

  function ensureScanner() {
    if (html5Scanner) {
      return html5Scanner;
    }
    if (typeof root.Html5Qrcode === 'undefined') {
      toastFn('Scanner library not available.');
      return null;
    }
    html5Scanner = new root.Html5Qrcode('scanner');
    return html5Scanner;
  }

  function startScanner() {
    var eventSelect = $('#event-select');
    var eventId = eventSelect && eventSelect.value;
    if (!eventId) {
      toastFn('Select an event before scanning.');
      return;
    }
    var scanner = ensureScanner();
    if (!scanner || scannerRunning) {
      return;
    }
    scannerRunning = true;
    scanner
      .start(
        { facingMode: 'environment' },
        { fps: 10, qrbox: 250 },
        function (decodedText) {
          onScan(decodedText);
        },
        onScanError
      )
      .catch(function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to start camera. Try the upload option.');
        scannerRunning = false;
      });
  }

  function stopScanner() {
    if (!html5Scanner || !scannerRunning) {
      return;
    }
    html5Scanner
      .stop()
      .then(function () {
        html5Scanner.clear();
        scannerRunning = false;
      })
      .catch(function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        scannerRunning = false;
      });
  }

  function onScan(decodedText) {
    if (!decodedText) {
      return;
    }
    var eventSelect = $('#event-select');
    var eventId = eventSelect && eventSelect.value;
    if (!eventId) {
      toastFn('Select an event before scanning.');
      return;
    }
    appendScanLog({ text: decodedText, status: 'pending' });
    callServer(
      'logAttendanceScan',
      [decodedText, eventId],
      function (res) {
        appendScanLog({
          text: decodedText,
          status: res && res.success ? 'success' : 'error',
          message: (res && res.message) || '',
        });
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        appendScanLog({ text: decodedText, status: 'error', message: 'Failed to record attendance.' });
      },
      { success: true, message: 'Recorded attendance.' }
    );
  }

  function appendScanLog(entry) {
    var output = $('#scan-output');
    if (!output) {
      return;
    }
    var row = document.createElement('div');
    row.className = 'scan-entry ' + (entry.status || 'info');
    row.innerHTML =
      '<strong>' +
      esc(entry.text || 'Unknown code') +
      '</strong><p class="muted">' +
      esc(entry.message || (entry.status === 'success' ? 'Attendance recorded.' : 'Processing…')) +
      '</p>';
    if (typeof output.prepend === 'function') {
      output.prepend(row);
    } else {
      output.insertBefore(row, output.firstChild);
    }
  }

  function decodeFile(file) {
    if (typeof root.Html5Qrcode === 'undefined') {
      toastFn('Scanner library not available.');
      return;
    }
    root.Html5Qrcode
      .scanFile(file, true)
      .then(function (result) {
        onScan(result);
      })
      .catch(function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to read the QR code from the file.');
      });
  }

  function onScanError(err) {
    if (root.console && typeof root.console.debug === 'function') {
      root.console.debug('Scan error', err);
    }
  }

  root.YSP = root.YSP || {};
  root.YSP.qr = root.YSP.qr || {};
  root.YSP.qr.setupQrAttendance = setupQrAttendance;
  root.YSP.qr.startScanner = startScanner;
  root.YSP.qr.stopScanner = stopScanner;
  root.YSP.qr.onScan = onScan;
  root.YSP.qr.onScanError = onScanError;

  root.setupQrAttendance = setupQrAttendance;
  root.startScanner = startScanner;
  root.stopScanner = stopScanner;
  root.onScan = onScan;
  root.onScanError = onScanError;
});
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  if (!root) {
    return;
  }

  if (!root.document) {
    root.setupManualAttendance = root.setupManualAttendance || function () {};
    root.bindManualAttendance = root.bindManualAttendance || function () {};
    return;
  }

  var $ = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};
  var callServer = root.YSP && root.YSP.utils && typeof root.YSP.utils.callServer === 'function'
    ? root.YSP.utils.callServer
    : function () {};
  var escFn = typeof root.esc === 'function'
    ? root.esc
    : function (value) {
        return String(value == null ? '' : value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      };
  var setTimeoutFn = typeof root.setTimeout === 'function' ? root.setTimeout.bind(root) : function (fn) {
    fn();
  };
  var clearTimeoutFn = typeof root.clearTimeout === 'function' ? root.clearTimeout.bind(root) : function () {};

  var manualBound = false;
  var manualSelected = null;
  var manualDebounce = null;

  function setupManualAttendance() {
    if (typeof root.populateActiveEvents === 'function') {
      root.populateActiveEvents('#manual-event');
    }
    var suggestions = $('#manual-suggestions');
    if (suggestions) {
      suggestions.innerHTML = '';
    }
    manualSelected = null;
  }

  function bindManualAttendance() {
    if (manualBound) {
      return;
    }
    var input = $('#manual-member');
    var list = $('#manual-suggestions');
    var btnIn = $('#manual-in');
    var btnOut = $('#manual-out');
    if (!input || !list) {
      return;
    }
    manualBound = true;
    input.addEventListener('input', function () {
      var query = input.value.trim();
      clearTimeoutFn(manualDebounce);
      manualDebounce = setTimeoutFn(function () {
        fetchManualSuggestions(query);
      }, query ? 200 : 0);
    });
    list.addEventListener('click', function (event) {
      var item = event.target && event.target.closest ? event.target.closest('li[data-id]') : null;
      if (!item) {
        return;
      }
      manualSelected = {
        id: item.getAttribute('data-id'),
        name: item.getAttribute('data-name'),
      };
      input.value = manualSelected.name;
      list.innerHTML = '';
    });
    if (btnIn) {
      btnIn.addEventListener('click', function () {
        submitManual('in');
      });
    }
    if (btnOut) {
      btnOut.addEventListener('click', function () {
        submitManual('out');
      });
    }
  }

  function fetchManualSuggestions(query) {
    var list = $('#manual-suggestions');
    if (!list) {
      return;
    }
    list.innerHTML = '';
    if (!query) {
      return;
    }
    callServer(
      'officerSuggestions',
      [query],
      function (res) {
        var suggestions = (res && res.data) || res || [];
        suggestions.forEach(function (item) {
          var li = document.createElement('li');
          var id = item.id || item.memberId || item.code;
          var name = item.name || item.fullName || 'Member';
          li.dataset.id = id;
          li.dataset.name = name;
          li.innerHTML = '<strong>' + escFn(name) + '</strong><span class="muted">' + escFn(id || '') + '</span>';
          list.appendChild(li);
        });
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load suggestions.');
      },
      [{ id: 'YSP0001', name: 'Juan Dela Cruz' }]
    );
  }

  function submitManual(action) {
    var eventSelect = $('#manual-event');
    var eventId = eventSelect && eventSelect.value;
    if (!manualSelected || !manualSelected.id) {
      toastFn('Select a member first.');
      return;
    }
    if (!eventId) {
      toastFn('Choose an event.');
      return;
    }
    callServer(
      'manualAttendance',
      [manualSelected.id, eventId, action],
      function (res) {
        toastFn(res && res.message ? res.message : 'Attendance saved.');
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to record attendance.');
      },
      { success: true, message: 'Attendance recorded.' }
    );
  }

  root.YSP = root.YSP || {};
  root.YSP.manual = root.YSP.manual || {};
  root.YSP.manual.setupManualAttendance = setupManualAttendance;
  root.YSP.manual.bindManualAttendance = bindManualAttendance;

  root.setupManualAttendance = setupManualAttendance;
  root.bindManualAttendance = bindManualAttendance;
});
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  var doc = root.document || null;
  var globalYsp = (root.YSP = root.YSP || {});
  var utils = (globalYsp.utils = globalYsp.utils || {});
  var callServer = typeof utils.callServer === 'function' ? utils.callServer : function () {};
  var selectOne = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var escapeHtml = typeof root.esc === 'function'
    ? root.esc
    : function (value) {
        return String(value == null ? '' : value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      };
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};

  function loadMyAttendance() {
    callServer(
      'getMyAttendance',
      [],
      function (res) {
        var rows = (res && res.data) || res || [];
        renderAttendanceTable(rows);
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load attendance records.');
      },
      [
        { date: '2024-01-12', event: 'Leadership Summit', timeIn: '08:00', timeOut: '17:00' },
        { date: '2024-02-05', event: 'Community Outreach', timeIn: '09:00', timeOut: '15:00' },
      ]
    );
  }

  function renderAttendanceTable(rows) {
    var tbody = selectOne('#attendance-rows');
    if (!tbody) {
      return;
    }
    tbody.innerHTML = '';
    if (!rows || !rows.length) {
      if (doc && typeof doc.createElement === 'function') {
        var empty = doc.createElement('tr');
        empty.innerHTML = '<td colspan="4" class="muted">No attendance records yet.</td>';
        tbody.appendChild(empty);
      }
      return;
    }
    rows.forEach(function (row) {
      if (!doc || typeof doc.createElement !== 'function') {
        return;
      }
      var tr = doc.createElement('tr');
      tr.innerHTML =
        '<td>' +
        escapeHtml(row.date || row[0] || '') +
        '</td><td>' +
        escapeHtml(row.event || row[1] || '') +
        '</td><td>' +
        escapeHtml(row.timeIn || row[2] || '') +
        '</td><td>' +
        escapeHtml(row.timeOut || row[3] || '') +
        '</td>';
      tbody.appendChild(tr);
    });
  }

  globalYsp.attendance = globalYsp.attendance || {};
  globalYsp.attendance.loadMyAttendance = loadMyAttendance;
  globalYsp.attendance.renderAttendanceTable = renderAttendanceTable;

  root.loadMyAttendance = loadMyAttendance;
  root.renderAttendanceTable = renderAttendanceTable;
});
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  if (!root) {
    return;
  }

  if (!root.document) {
    root.loadKpis = root.loadKpis || function () {};
    root.renderKpiChart = root.renderKpiChart || function () {};
    return;
  }

  var $ = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};
  var callServer = root.YSP && root.YSP.utils && typeof root.YSP.utils.callServer === 'function'
    ? root.YSP.utils.callServer
    : function () {};

  var chartInstance = null;

  function loadKpis() {
    callServer(
      'getAttendanceKPIs',
      [],
      function (res) {
        var data = res && res.data ? res.data : res;
        renderKpiChart($('#kpi-chart'), data || {});
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load KPI data.');
      },
      {
        labels: ['Jan', 'Feb', 'Mar', 'Apr'],
        present: [32, 28, 40, 36],
        absent: [4, 6, 5, 3],
      }
    );
  }

  function renderKpiChart(canvas, kpi) {
    var ctx = canvas && typeof canvas.getContext === 'function' ? canvas.getContext('2d') : null;
    if (!ctx || typeof root.Chart !== 'function') {
      return;
    }
    var labels = (kpi && kpi.labels) || ['Jan', 'Feb', 'Mar'];
    var present = (kpi && kpi.present) || [0, 0, 0];
    var absent = (kpi && kpi.absent) || [0, 0, 0];
    if (chartInstance) {
      chartInstance.data.labels = labels;
      chartInstance.data.datasets[0].data = present;
      chartInstance.data.datasets[1].data = absent;
      chartInstance.update();
      return;
    }
    chartInstance = new root.Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [
          {
            label: 'Present',
            data: present,
            backgroundColor: 'rgba(246, 66, 31, 0.85)',
            borderRadius: 12,
          },
          {
            label: 'Absent',
            data: absent,
            backgroundColor: 'rgba(29, 29, 31, 0.18)',
            borderRadius: 12,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            grid: { display: false },
            stacked: false,
          },
          y: {
            beginAtZero: true,
            grid: { color: 'rgba(0,0,0,0.05)' },
          },
        },
        plugins: {
          legend: {
            position: 'bottom',
          },
        },
      },
    });
  }

  root.YSP = root.YSP || {};
  root.YSP.kpis = root.YSP.kpis || {};
  root.YSP.kpis.loadKpis = loadKpis;
  root.YSP.kpis.renderKpiChart = renderKpiChart;

  root.loadKpis = loadKpis;
  root.renderKpiChart = renderKpiChart;
});
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  if (!root) {
    return;
  }

  if (!root.document) {
    root.loadEvents = root.loadEvents || function () {};
    root.renderEvents = root.renderEvents || function () {};
    root.populateActiveEvents = root.populateActiveEvents || function () {};
    return;
  }

  var $ = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};
  var showModalFn = typeof root.showModal === 'function' ? root.showModal : function () { return document.createElement('div'); };
  var closeModalFn = typeof root.closeModal === 'function' ? root.closeModal : function () {};
  var callServer = root.YSP && root.YSP.utils && typeof root.YSP.utils.callServer === 'function'
    ? root.YSP.utils.callServer
    : function () {};

  var eventsCache = null;
  var createBound = false;

  function loadEvents() {
    if (!createBound) {
      var createBtn = $('#btn-create-event');
      if (createBtn) {
        createBound = true;
        createBtn.addEventListener('click', openCreateEventModal);
      }
    }
    callServer(
      'listEvents',
      [],
      function (res) {
        var list = (res && res.data) || res || [];
        eventsCache = list;
        renderEvents(list);
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load events.');
      },
      [
        { id: 'EVT-001', name: 'Leadership Summit', date: '2024-03-20', active: true },
        { id: 'EVT-002', name: 'Community Outreach', date: '2024-04-15', active: false },
      ]
    );
    populateActiveEvents('#event-select');
    populateActiveEvents('#manual-event');
  }

  function renderEvents(list) {
    var tbody = $('#events-rows');
    if (!tbody) {
      return;
    }
    tbody.innerHTML = '';
    if (!list || !list.length) {
      var empty = document.createElement('tr');
      empty.innerHTML = '<td colspan="4" class="muted">No events found.</td>';
      tbody.appendChild(empty);
      return;
    }
    list.forEach(function (event) {
      var tr = document.createElement('tr');
      tr.innerHTML =
        '<td>' +
        esc(event.name || event.title || 'Event') +
        '</td><td>' +
        esc(event.date || '') +
        '</td><td>' +
        (event.active ? '<span class="status-badge active">Active</span>' : '<span class="status-badge">Inactive</span>') +
        '</td><td><button type="button" class="btn btn-outline" data-toggle="' +
        esc(event.id) +
        '">' +
        (event.active ? 'Disable' : 'Enable') +
        '</button></td>';
      tbody.appendChild(tr);
    });
    tbody.querySelectorAll('button[data-toggle]').forEach(function (btn) {
      btn.addEventListener('click', function () {
        var id = btn.getAttribute('data-toggle');
        toggleEventActive(id);
      });
    });
  }

  function populateActiveEvents(selectEl) {
    var select = typeof selectEl === 'string' ? $(selectEl) : selectEl;
    if (!select) {
      return;
    }
    callServer(
      'getActiveEvents',
      [],
      function (res) {
        var events = (res && res.data) || res || [];
        renderEventOptions(select, events);
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load events.');
      },
      [{ id: 'EVT-001', name: 'Leadership Summit' }]
    );
  }

  function renderEventOptions(select, list) {
    select.innerHTML = '<option value="">Select event</option>';
    list.forEach(function (event) {
      var option = document.createElement('option');
      option.value = event.id || event.code;
      option.textContent = event.name || event.title;
      select.appendChild(option);
    });
  }

  function toggleEventActive(id) {
    if (!id) {
      return;
    }
    callServer(
      'toggleEventActive',
      [id],
      function (res) {
        toastFn(res && res.message ? res.message : 'Event updated.');
        loadEvents();
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to update event.');
      },
      { success: true, message: 'Event updated.' }
    );
  }

  function openCreateEventModal() {
    var panel = showModalFn({
      title: 'Create Event',
      bodyHtml:
        '<div class="form-group"><label>Name<input id="event-name" type="text" placeholder="Event name" /></label></div>' +
        '<div class="form-group"><label>Date<input id="event-date" type="date" /></label></div>',
      footerHtml:
        '<button type="button" class="btn btn-outline" data-close="1">Cancel</button>' +
        '<button type="button" class="btn btn-primary" id="event-save">Save Event</button>',
    });
    if (!panel || typeof panel.querySelector !== 'function') {
      return;
    }
    var saveBtn = panel.querySelector('#event-save');
    if (saveBtn) {
      saveBtn.addEventListener('click', function () {
        var nameInput = $('#event-name');
        var dateInput = $('#event-date');
        var name = String((nameInput && nameInput.value) || '').trim();
        var date = dateInput ? dateInput.value : '';
        if (!name || !date) {
          toastFn('Provide event name and date.');
          return;
        }
        callServer(
          'createEvent',
          [{ name: name, date: date }],
          function (res) {
            closeModalFn();
            toastFn(res && res.message ? res.message : 'Event created.');
            loadEvents();
          },
          function (err) {
            if (root.console && typeof root.console.error === 'function') {
              root.console.error(err);
            }
            toastFn('Unable to create event.');
          },
          { success: true, message: 'Event created.' }
        );
      });
    }
  }

  root.YSP = root.YSP || {};
  root.YSP.events = root.YSP.events || {};
  root.YSP.events.loadEvents = loadEvents;
  root.YSP.events.renderEvents = renderEvents;
  root.YSP.events.populateActiveEvents = populateActiveEvents;

  root.loadEvents = loadEvents;
  root.renderEvents = renderEvents;
  root.populateActiveEvents = populateActiveEvents;
});
</script>
<script>
(function (factory) {
  var root = typeof window !== 'undefined' ? window : typeof globalThis !== 'undefined' ? globalThis : {};
  factory(root);
})(function (root) {
  'use strict';

  if (!root || !root.document) {
    if (root) {
      root.loadAnnouncements = root.loadAnnouncements || function () {};
      root.renderAnnouncements = root.renderAnnouncements || function () {};
    }
    return;
  }

  var doc = root.document;
  var globalYsp = (root.YSP = root.YSP || {});
  var utils = (globalYsp.utils = globalYsp.utils || {});
  var callServer = typeof utils.callServer === 'function' ? utils.callServer : function () {};
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};
  var showModalFn = typeof root.showModal === 'function' ? root.showModal : function () { return doc.createElement('div'); };
  var closeModalFn = typeof root.closeModal === 'function' ? root.closeModal : function () {};
  var selectOne = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var escapeHtml = typeof root.esc === 'function' ? root.esc : function (value) {
    return String(value == null ? '' : value);
  };

  var createBound = false;

  function loadAnnouncements() {
    if (!createBound) {
      var btn = selectOne('#btn-new-announcement');
      if (btn) {
        createBound = true;
        btn.addEventListener('click', openAnnouncementModal);
      }
    }
    callServer(
      'listAnnouncements',
      [],
      function (res) {
        var list = (res && res.data) || res || [];
        renderAnnouncements(list);
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load announcements.');
      },
      [
        { id: 'ANN-1', title: 'General Assembly', body: 'Join us this Saturday for our monthly assembly.', read: false },
        { id: 'ANN-2', title: 'Volunteer Drive', body: 'Sign up for the coastal cleanup happening next week.', read: true },
      ]
    );
  }

  function renderAnnouncements(list) {
    var container = selectOne('#announcement-list');
    if (!container) {
      return;
    }
    container.innerHTML = '';
    if (!list || !list.length) {
      container.innerHTML = '<p class="muted">No announcements yet.</p>';
      return;
    }
    list.forEach(function (item) {
      var card = doc.createElement('article');
      card.className = 'card announcement-card';
      card.style.borderLeft = item.read ? '4px solid rgba(0,0,0,0.08)' : '4px solid var(--primary)';
      card.innerHTML =
        '<h3>' +
        escapeHtml(item.title || 'Announcement') +
        '</h3><p class="muted">' +
        escapeHtml(item.body || '') +
        '</p>';
      container.appendChild(card);
    });
  }

  function openAnnouncementModal() {
    var panel = showModalFn({
      title: 'Create Announcement',
      bodyHtml:
        '<div class="form-group"><label>Title<input id="announcement-title" type="text" placeholder="Announcement title" /></label></div>' +
        '<div class="form-group"><label>Message<textarea id="announcement-body" rows="4" placeholder="Announcement body"></textarea></label></div>',
      footerHtml:
        '<button type="button" class="btn btn-outline" data-close="1">Cancel</button>' +
        '<button type="button" class="btn btn-primary" id="announcement-save">Publish</button>',
    });
    if (!panel || typeof panel.querySelector !== 'function') {
      return;
    }
    var save = panel.querySelector('#announcement-save');
    if (save) {
      save.addEventListener('click', function () {
        var titleEl = selectOne('#announcement-title');
        var bodyEl = selectOne('#announcement-body');
        var title = String((titleEl && titleEl.value) || '').trim();
        var body = String((bodyEl && bodyEl.value) || '').trim();
        if (!title || !body) {
          toastFn('Please provide a title and message.');
          return;
        }
        callServer(
          'createAnnouncement',
          [{ title: title, body: body }],
          function (res) {
            closeModalFn();
            toastFn(res && res.message ? res.message : 'Announcement posted.');
            loadAnnouncements();
          },
          function (err) {
            if (root.console && typeof root.console.error === 'function') {
              root.console.error(err);
            }
            toastFn('Unable to publish announcement.');
          },
          { success: true, message: 'Announcement created.' }
        );
      });
    }
  }

  globalYsp.announcements = globalYsp.announcements || {};
  globalYsp.announcements.loadAnnouncements = loadAnnouncements;
  globalYsp.announcements.renderAnnouncements = renderAnnouncements;

  root.loadAnnouncements = loadAnnouncements;
  root.renderAnnouncements = renderAnnouncements;
});
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  if (!root) {
    return;
  }

  if (!root.document) {
    root.loadMyFeedback = root.loadMyFeedback || function () {};
    root.loadFeedbackAdmin = root.loadFeedbackAdmin || function () {};
    return;
  }

  var $ = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var toastFn = typeof root.toast === 'function' ? root.toast : function () {};
  var callServer = root.YSP && root.YSP.utils && typeof root.YSP.utils.callServer === 'function'
    ? root.YSP.utils.callServer
    : function () {};
  var escFn = typeof root.esc === 'function'
    ? root.esc
    : function (value) {
        return String(value == null ? '' : value)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      };

  var feedbackBound = false;

  function loadMyFeedback() {
    if (!feedbackBound) {
      var sendBtn = $('#btn-send-feedback');
      if (sendBtn) {
        feedbackBound = true;
        sendBtn.addEventListener('click', submitFeedback);
      }
    }
    callServer(
      'listMyFeedback',
      [],
      function (res) {
        var list = (res && res.data) || res || [];
        renderFeedbackList('#my-feedback-list', list, true);
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load your feedback.');
      },
      [
        { id: 'FB-001', body: 'Great job on the last outreach!', createdAt: '2024-02-01' },
      ]
    );
  }

  function submitFeedback() {
    var textarea = $('#feedback-text');
    if (!textarea) {
      return;
    }
    var text = String(textarea.value || '').trim();
    if (!text) {
      toastFn('Please write your feedback first.');
      return;
    }
    callServer(
      'sendFeedback',
      [text],
      function (res) {
        textarea.value = '';
        toastFn(res && res.message ? res.message : 'Feedback submitted.');
        loadMyFeedback();
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to send feedback.');
      },
      { success: true, message: 'Feedback received. Thank you!' }
    );
  }

  function loadFeedbackAdmin() {
    callServer(
      'listAllFeedback',
      [],
      function (res) {
        var list = (res && res.data) || res || [];
        renderFeedbackList('#feedback-admin-list', list, false);
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        toastFn('Unable to load feedback inbox.');
      },
      [
        { id: 'FB-100', body: 'Request more leadership workshops.', member: 'Maria Santos', createdAt: '2024-02-12' },
      ]
    );
  }

  function renderFeedbackList(selector, list, includeDate) {
    var container = typeof selector === 'string' ? $(selector) : selector;
    if (!container) {
      return;
    }
    container.innerHTML = '';
    if (!list || !list.length) {
      container.innerHTML = '<p class="muted">No feedback yet.</p>';
      return;
    }
    list.forEach(function (item) {
      var card = document.createElement('article');
      card.className = 'card feedback-card';
      var header = item.member ? '<h3>' + escFn(item.member) + '</h3>' : '';
      var date = includeDate || item.createdAt ? '<p class="muted">' + escFn(item.createdAt || '') + '</p>' : '';
      card.innerHTML = header + '<p>' + escFn(item.body || '') + '</p>' + date;
      container.appendChild(card);
    });
  }

  root.YSP = root.YSP || {};
  root.YSP.feedback = root.YSP.feedback || {};
  root.YSP.feedback.loadMyFeedback = loadMyFeedback;
  root.YSP.feedback.loadFeedbackAdmin = loadFeedbackAdmin;

  root.loadMyFeedback = loadMyFeedback;
  root.loadFeedbackAdmin = loadFeedbackAdmin;
});
</script>
<script>
(function (factory) {
  var root;
  if (typeof window !== 'undefined') {
    root = window;
  } else if (typeof self !== 'undefined') {
    root = self;
  } else if (typeof globalThis !== 'undefined') {
    root = globalThis;
  } else {
    try {
      root = Function('return this')();
    } catch (err) {
      root = {};
    }
  }
  factory(root || {});
})(function (root) {
  'use strict';

  var globalYsp = (root.YSP = root.YSP || {});
  var utils = (globalYsp.utils = globalYsp.utils || {});
  var callServer = typeof utils.callServer === 'function' ? utils.callServer : function () {};
  var safeToast = typeof root.toast === 'function' ? root.toast : function () {};
  var select = typeof root.$ === 'function' ? root.$ : function () { return null; };
  var escapeHtml = typeof root.esc === 'function' ? root.esc : function (value) {
    return String(value == null ? '' : value);
  };

  function loadAccessLogs() {
    callServer(
      'getAccessLogs',
      [],
      function (res) {
        var rows = (res && res.data) || res || [];
        renderAccessLogs(rows);
      },
      function (err) {
        if (root.console && typeof root.console.error === 'function') {
          root.console.error(err);
        }
        safeToast('Unable to load access logs.');
      },
      [
        { timestamp: '2024-02-10 09:30', id: 'YSP0001', name: 'Juan Dela Cruz' },
      ]
    );
  }

  function renderAccessLogs(rows) {
    var tbody = select('#access-log-rows');
    if (!tbody) {
      return;
    }
    tbody.innerHTML = '';
    if (!rows || !rows.length) {
      var empty = root.document ? root.document.createElement('tr') : null;
      if (empty) {
        empty.innerHTML = '<td colspan="3" class="muted">No logs yet.</td>';
        tbody.appendChild(empty);
      }
      return;
    }
    rows.forEach(function (row) {
      var tr = root.document ? root.document.createElement('tr') : null;
      if (!tr) {
        return;
      }
      tr.innerHTML =
        '<td>' +
        escapeHtml(row.timestamp || row[0] || '') +
        '</td><td>' +
        escapeHtml(row.id || row.code || row[1] || '') +
        '</td><td>' +
        escapeHtml(row.name || row.fullName || row[2] || '') +
        '</td>';
      tbody.appendChild(tr);
    });
  }

  globalYsp.accessLogs = globalYsp.accessLogs || {};
  globalYsp.accessLogs.loadAccessLogs = loadAccessLogs;
  globalYsp.accessLogs.renderAccessLogs = renderAccessLogs;

  if (typeof root.loadAccessLogs !== 'function') {
    root.loadAccessLogs = loadAccessLogs;
  }
});
</script>
  <script>
    onReady(function () {
      $$('.panel').forEach(function (panel) {
        var isLogin = panel.id === 'login-panel';
        panel.classList.toggle('hidden', !isLogin);
        panel.classList.toggle('active', isLogin);
      });
      bindLogin();
      bindBackButtons();
      if (typeof google !== 'undefined' && google.script && google.script.run && typeof google.script.run.getSession === 'function') {
        google.script.run
          .withSuccessHandler(function (res) {
            if (res && res.user) {
              setSession(res.user);
              show('main-menu-panel');
            }
          })
          .withFailureHandler(function () {
            console.warn('Unable to restore session.');
          })
          .getSession();
      }
    });
  </script>
</body>
</html>
