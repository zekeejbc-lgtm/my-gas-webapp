<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YSP Tagum — Member App</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Lexend:wght@500;600;700&family=Roboto:wght@400;500;700&display=swap"
    rel="stylesheet"
  />
  <link rel="icon" href="https://i.imgur.com/J4wddTW.png" />
  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <?!= include('YSP_Tokens'); ?>
  <?!= include('YSP_Components'); ?>
  <?!= include('YSP_Panels'); ?>
</head>
<body>
  <div id="app" class="app-shell">
    <section class="panel" id="login-panel">
      <div class="login-illustration">
        <div class="login-brand">
          <img src="https://i.imgur.com/J4wddTW.png" alt="YSP Tagum" class="login-logo" />
          <h1 class="login-title">YSP Tagum Member Portal</h1>
          <p class="login-subtitle">Empowering young leaders through unified service and collaboration.</p>
        </div>
      </div>
      <div class="login-form" role="form" aria-labelledby="login-heading">
        <h2 id="login-heading">Sign in</h2>
        <div class="form-group">
          <label for="username">Email or ID</label>
          <input id="username" name="username" type="text" autocomplete="username" placeholder="Enter your email or ID" />
        </div>
        <div class="form-group password-group">
          <label for="password">Password</label>
          <div class="password-input">
            <input id="password" name="password" type="password" autocomplete="current-password" placeholder="Enter your password" />
            <button id="eye-toggle" type="button" class="eye-toggle" aria-label="Show password" aria-pressed="false">
              <span class="eye">
                <span class="eye-ball"></span>
                <span class="eye-lid"></span>
              </span>
            </button>
          </div>
        </div>
        <div class="form-actions">
          <button id="login-btn" type="button" class="btn btn-primary btn-block">Log In</button>
          <button id="guest-login-btn" type="button" class="btn btn-outline btn-block">Log in as Guest</button>
        </div>
        <p class="login-footnote">Authorized members only. Guests may explore limited features.</p>
      </div>
    </section>

    <section class="panel hidden" id="main-menu-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn" data-target="login-panel">&larr; Back to Login</button>
        <div>
          <h2 class="panel-title">Welcome back, <span id="welcome-name">Member</span>!</h2>
          <p class="panel-subtitle">Choose an area below to manage your YSP experience.</p>
        </div>
      </header>
      <div id="dashboard-tiles" class="tile-grid" role="list"></div>
    </section>

    <section class="panel hidden" id="homepage-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn" data-target="login-panel">&larr; Back to Login</button>
        <div>
          <h2 class="panel-title">Homepage</h2>
          <p class="panel-subtitle">Discover the latest highlights from YSP Tagum.</p>
        </div>
      </header>
      <article class="card">
        <h3>About</h3>
        <p id="home-about" class="muted">Loading content…</p>
      </article>
      <div class="grid two">
        <article class="card">
          <h3>Mission</h3>
          <p id="home-mission" class="muted">…</p>
        </article>
        <article class="card">
          <h3>Vision</h3>
          <p id="home-vision" class="muted">…</p>
        </article>
      </div>
      <article class="card">
        <h3>Objectives</h3>
        <ul id="home-objectives" class="bullet-list"></ul>
      </article>
      <article class="card ratio-card">
        <h3>Organizational Chart</h3>
        <div class="ratio ratio-16x9">
          <img id="home-org-chart" src="https://placehold.co/1280x720?text=Organizational+Chart" alt="Organizational chart" />
        </div>
      </article>
      <section class="card" id="projects-section">
        <header class="section-header">
          <h3>Flagship Projects</h3>
        </header>
        <div id="projects-grid" class="grid three"></div>
      </section>
      <section class="grid two" id="contacts-section">
        <article class="card">
          <h3>Report Issues</h3>
          <p class="muted">Reach us for support via Facebook or Email.</p>
          <div class="button-stack">
            <button type="button" class="btn btn-primary" id="contact-facebook">Open Facebook</button>
            <button type="button" class="btn btn-outline" id="contact-email">Compose Email</button>
          </div>
        </article>
        <article class="card">
          <h3>Web App Developer</h3>
          <p id="developer-info" class="muted">Maintained by YSP Tagum Digital Services.</p>
        </article>
      </section>
    </section>

    <section class="panel hidden" id="profile-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Profile &amp; ID</h2>
          <p class="panel-subtitle">Review your account and download your QR ID.</p>
        </div>
      </header>
      <article id="profile-card" class="card profile-card">
        <div class="profile-info">
          <img id="profile-avatar" src="https://placehold.co/400x400?text=Member" alt="Profile avatar" />
          <div>
            <h3 id="profile-name">Member Name</h3>
            <p id="profile-role" class="muted">Role</p>
            <p id="profile-email" class="muted">Email</p>
            <p id="profile-id" class="muted">ID Code</p>
          </div>
        </div>
        <div class="profile-qr">
          <div id="qrid" class="qr-box" aria-live="polite"></div>
          <button id="btn-download-qr" type="button" class="btn btn-outline">Download QR</button>
        </div>
      </article>
    </section>

    <section class="panel hidden" id="qr-attendance-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">QR Attendance</h2>
          <p class="panel-subtitle">Scan members for instant attendance logging.</p>
        </div>
      </header>
      <div class="card">
        <label for="event-select">Active Event</label>
        <select id="event-select"></select>
        <div class="button-row">
          <button id="btn-start-scan" type="button" class="btn btn-primary">Start Scanner</button>
          <button id="btn-stop-scan" type="button" class="btn btn-outline">Stop Scanner</button>
        </div>
        <div id="scanner" class="scanner-box" aria-live="polite"></div>
        <div class="upload-fallback">
          <label for="qr-file">Upload QR Image</label>
          <input id="qr-file" type="file" accept="image/*" />
        </div>
      </div>
      <article class="card">
        <h3>Scan Results</h3>
        <div id="scan-output" class="scan-log" aria-live="polite"></div>
      </article>
    </section>

    <section class="panel hidden" id="manual-attendance-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Manual Attendance</h2>
          <p class="panel-subtitle">Record attendance for members manually.</p>
        </div>
      </header>
      <div class="card">
        <label for="manual-event">Select Event</label>
        <select id="manual-event"></select>
        <div class="form-group">
          <label for="manual-member">Search Member</label>
          <input id="manual-member" type="text" placeholder="Search by name or ID" autocomplete="off" />
        </div>
        <ul id="manual-suggestions" class="suggestions"></ul>
        <div class="button-row">
          <button id="manual-in" type="button" class="btn btn-primary">Time In</button>
          <button id="manual-out" type="button" class="btn btn-outline">Time Out</button>
        </div>
      </div>
    </section>

    <section class="panel hidden" id="attendance-dashboard-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Attendance Dashboard</h2>
          <p class="panel-subtitle">Visualize participation across events.</p>
        </div>
      </header>
      <article class="card">
        <canvas id="kpi-chart" height="320" role="img" aria-label="Attendance KPIs chart"></canvas>
      </article>
    </section>

    <section class="panel hidden" id="attendance-trans-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Attendance Transparency</h2>
          <p class="panel-subtitle">Track your attendance record.</p>
        </div>
      </header>
      <div class="card table-card">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Event</th>
                <th>Time In</th>
                <th>Time Out</th>
              </tr>
            </thead>
            <tbody id="attendance-rows"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="panel hidden" id="manage-events-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Manage Events</h2>
          <p class="panel-subtitle">Create and update YSP events.</p>
        </div>
      </header>
      <div class="card">
        <button id="btn-create-event" type="button" class="btn btn-primary">Create Event</button>
      </div>
      <div class="card table-card">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Event</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="events-rows"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="panel hidden" id="directory-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Officer Directory</h2>
          <p class="panel-subtitle">Find officers and members quickly.</p>
        </div>
      </header>
      <div class="card">
        <label for="search-input">Search Members</label>
        <input id="search-input" type="text" placeholder="Type name or ID" autocomplete="off" />
        <ul id="suggestions-list" class="suggestions" role="listbox"></ul>
      </div>
      <article id="directory-result" class="card profile-card muted">Search to view member details.</article>
    </section>

    <section class="panel hidden" id="announcements-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Announcements</h2>
          <p class="panel-subtitle">Share updates with the YSP community.</p>
        </div>
      </header>
      <div class="card">
        <button id="btn-new-announcement" type="button" class="btn btn-primary">Create Announcement</button>
      </div>
      <div id="announcement-list" class="stack"></div>
    </section>

    <section class="panel hidden" id="submit-feedback-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Submit Feedback</h2>
          <p class="panel-subtitle">Tell us how we can improve.</p>
        </div>
      </header>
      <div class="card">
        <label for="feedback-text">Your Feedback</label>
        <textarea id="feedback-text" rows="6" placeholder="Share your thoughts"></textarea>
        <button id="btn-send-feedback" type="button" class="btn btn-primary">Send Feedback</button>
      </div>
      <section class="card">
        <h3>Your Previous Feedback</h3>
        <div id="my-feedback-list" class="stack"></div>
      </section>
    </section>

    <section class="panel hidden" id="view-feedback-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Feedback Inbox</h2>
          <p class="panel-subtitle">Review submissions from members.</p>
        </div>
      </header>
      <div id="feedback-admin-list" class="stack"></div>
    </section>

    <section class="panel hidden" id="view-logs-panel">
      <header class="panel-header">
        <button class="btn btn-text back-btn">&larr; Back</button>
        <div>
          <h2 class="panel-title">Access Logs</h2>
          <p class="panel-subtitle">Monitor sign-in history for transparency.</p>
        </div>
      </header>
      <div class="card table-card">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>ID Code</th>
                <th>Name</th>
              </tr>
            </thead>
            <tbody id="access-log-rows"></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <div id="modal-root" hidden></div>
  <div id="toast-root" aria-live="polite" aria-atomic="true"></div>

  <?!= include('Shared'); ?>
  <?!= include('YSP_Utils'); ?>
  <?!= include('YSP_Modal'); ?>
  <?!= include('YSP_Login'); ?>
  <?!= include('YSP_Homepage'); ?>
  <?!= include('YSP_Directory'); ?>
  <?!= include('YSP_QR'); ?>
  <?!= include('YSP_Manual'); ?>
  <?!= include('YSP_Attendance'); ?>
  <?!= include('YSP_KPIs'); ?>
  <?!= include('YSP_Events'); ?>
  <?!= include('YSP_Announcements'); ?>
  <?!= include('YSP_Feedback'); ?>
  <?!= include('YSP_AccessLogs'); ?>
  <script>
    onReady(function () {
      $$('.panel').forEach(function (panel) {
        var isLogin = panel.id === 'login-panel';
        panel.classList.toggle('hidden', !isLogin);
        panel.classList.toggle('active', isLogin);
      });
      bindLogin();
      bindBackButtons();
      if (typeof google !== 'undefined' && google.script && google.script.run && typeof google.script.run.getSession === 'function') {
        google.script.run
          .withSuccessHandler(function (res) {
            if (res && res.user) {
              setSession(res.user);
              show('main-menu-panel');
            }
          })
          .withFailureHandler(function () {
            console.warn('Unable to restore session.');
          })
          .getSession();
      }
    });
  </script>
</body>
</html>
