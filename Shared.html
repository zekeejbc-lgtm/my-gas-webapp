(function () {
  'use strict';
  window.YSP = window.YSP || {};
  YSP.ns = function (path) {
    return String(path || '')
      .split('.')
      .filter(function (segment) {
        return !!segment;
      })
      .reduce(function (acc, key) {
        if (!acc[key]) {
          acc[key] = {};
        }
        return acc[key];
      }, YSP);
  };

  function ensureUrl(value, fallback) {
    try {
      var raw = String(value || '').trim();
      if (!raw) {
        return fallback;
      }
      var withProto = /^https?:/i.test(raw) ? raw : 'https://' + raw;
      var parsed = new URL(withProto);
      if (parsed.protocol === 'http:' || parsed.protocol === 'https:') {
        return parsed.toString();
      }
      return fallback;
    } catch (err) {
      return fallback;
    }
  }

  YSP.safeUrl = function (value) {
    return ensureUrl(value, '');
  };

  YSP.safeImage = function (value) {
    return ensureUrl(value, 'https://placehold.co/960x540?text=YSP');
  };

  window.onerror = function (msg, src, line, col, err) {
    try {
      if (
        typeof google !== 'undefined' &&
        google.script &&
        google.script.run &&
        typeof google.script.run.logClientError === 'function'
      ) {
        google.script.run.logClientError(String(msg), String(src), Number(line) || 0, Number(col) || 0);
      }
    } catch (loggingError) {
      // swallow logging errors
    }
    console.error('Global JS Error:', msg, 'at', src, line, col, err);
  };
})();
